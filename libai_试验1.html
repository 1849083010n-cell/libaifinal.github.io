
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Li Bai - Poet & Wanderer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <!-- React & Babel (Standard UMD for better local file support) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Styles -->
    <style>
        @keyframes gradient-x { 0%, 100% { background-position: left center; } 50% { background-position: right center; } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slowZoom { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

        .animate-gradient-x { animation: gradient-x 3s ease infinite; background-size: 200% 200%; }
        .animate-blink { animation: blink 1s step-end infinite; }
        .animate-fade-up { animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .hover-zoom-img:hover { animation: slowZoom 3s ease-out forwards; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Noto Serif SC', serif; }
        .font-calligraphy { font-family: 'Ma Shan Zheng', cursive; }
        .leaflet-container { z-index: 0; }
        .writing-vertical { writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 0.2em; }
        
        .bg-paper-texture {
            background-color: #fdfbf7;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
        }
        .ink-shadow { box-shadow: 0 20px 40px -10px rgba(0,0,0,0.15); }
        
        #loading-screen {
            position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; justify-content: center; align-items: center;
            font-family: 'Noto Serif SC', serif; font-size: 1.5rem; color: #555;
        }
    </style>
</head>
<body class="bg-stone-50 text-gray-900 antialiased">
    <div id="loading-screen">Á≥ªÁªüÂàùÂßãÂåñ‰∏≠... (Initializing...)</div>
    <div id="root"></div>

    <!-- Polyfill for process (prevents crashes in some envs) -->
    <script>window.process = { env: {} };</script>

    <!-- Main Application Script -->
    <script type="text/babel">
        // Remove loading screen when React starts
        setTimeout(() => {
            const loader = document.getElementById('loading-screen');
            if(loader) loader.style.display = 'none';
        }, 800);

        // Access React globals
        const { useState, useEffect, useRef, useMemo } = React;
        const { createRoot } = ReactDOM;

        // --- CONSTANTS & DATA ---
        
        const T = {
            'app.title': { zh: 'LI BAI', en: 'LI BAI' },
            'nav.life': { zh: 'ËØó‰ªôÁîüÂπ≥', en: 'Biography' },
            'nav.emotion': { zh: 'ÊÉÖÊÑüÂõæË∞±', en: 'Emotion Map' },
            'nav.footprint': { zh: 'Ë∂≥ËøπÊº´Ê∏∏', en: 'Footprints' },
            'nav.drink': { zh: '‰∏é‰ªôÂØπÈ•Æ', en: 'Drink w/ Li' },
            'nav.about': { zh: 'ÂÖ≥‰∫éÊàë‰ª¨', en: 'About Us' },
            'nav.lang': { zh: 'English', en: '‰∏≠Êñá' },
            
            'home.hero.title': { zh: 'ÊùéÁôΩËæâÁÖåÁöÑ‰∏ÄÁîü', en: 'The Glorious Life of Li Bai' },
            'home.desc': { zh: 'ÊàëÊòØÊùéÁôΩÔºå‰∏Ä‰ΩçÊµÅÊµ™‰∫éÂ§©Âú∞Èó¥ÁöÑËØó‰ªô„ÄÇ\nÂ∏ÆÂä©‰∏ñ‰∫∫ÊÑüÂèóÁõõÂîêÊ∞îË±°Ôºå\nÁî®ËØóÊ≠åËøûÊé•Âè§‰ªäÔºå‰ª•ÈÖíÂÖ•ÈÅìÔºåÊé¢ÂØªËá™Áî±‰∏éÊµ™Êº´ÁöÑÁúüË∞õ„ÄÇ', en: 'I am Li Bai, a poet wandering between heaven and earth.\nExperience the grandeur of the High Tang,\nConnect past and present through poetry, and seek the truth of freedom and romance through wine.' },
            'footer.text': { zh: '¬© 701-762 ÂîêÊúù. Powered by DeepSeek AI.', en: '¬© 701-762 Tang Dynasty. Powered by DeepSeek AI.' },

            'search.placeholder': { zh: 'ÈóÆÈóÆÊùéÁôΩ...', en: 'Ask Li Bai...' },
            'search.btn': { zh: 'ËØó‰ªôËß£Áñë', en: 'Ask Li Bai' },
            'search.btn_alt': { zh: '‰∏ÄÈóÆ‰∏âÊùé', en: 'Three Ages' },
            
            'life.title': { zh: 'ËØó‰ªôÁîüÂπ≥', en: 'Biography' },
            'life.back': { zh: 'ËøîÂõû‰∏ªÈ°µ', en: 'Back Home' },

            'emotion.title': { zh: 'ÊÉÖÊÑüÂõæË∞±', en: 'Emotion Map' },
            'emotion.subtitle': { zh: 'Êé¢Á¥¢‰∏çÂêåÊó∂Êúü‰∏éÂú∞ÁÇπÁöÑËØóÊ≠åÊÉÖÊÑüÊµìÂ∫¶', en: 'Explore emotional intensity across time and place' },
            'emotion.period': { zh: '‰∫∫ÁîüÈò∂ÊÆµ', en: 'Life Stage' },
            'emotion.core': { zh: 'Ê†∏ÂøÉÊÉÖÊÑü', en: 'Core Emotion' },
            'emotion.exit': { zh: 'ÈÄÄÂá∫', en: 'Exit' },
            'emotion.stats_title': { zh: 'ÊÑèË±°‰∏éÊô∫ËÉΩËµèÊûê', en: 'Imagery & AI Analysis' },
            'emotion.fav_words': { zh: 'ÊùéÁôΩÊúÄÁà±Áî®ÁöÑËØç (Top 8)', en: "Li Bai's Favorite Words (Top 8)" },
            'emotion.dist': { zh: 'ÊÑèË±°ÊÉÖÊÑüÂàÜÂ∏É', en: 'Imagery Emotion Distribution' },
            'emotion.ai_title': { zh: 'AI Êô∫ËÉΩËµèÊûê', en: 'AI Analysis' },
            'emotion.select_year': { zh: '1. Âπ¥‰ªΩ', en: '1. Year' },
            'emotion.select_loc': { zh: '2. Âú∞ÁÇπ', en: '2. Location' },
            'emotion.select_mood': { zh: '3. ÊÉÖÊÑü', en: '3. Emotion' },
            'emotion.select_poem': { zh: '4. ËØó‰Ωú', en: '4. Poem' },
            'emotion.btn_analyze': { zh: '‚ú® ÁîüÊàêÊ∑±Â∫¶ËµèÊûê', en: '‚ú® Generate Analysis' },
            'emotion.analyzing': { zh: 'ÂàÜÊûê‰∏≠...', en: 'Analyzing...' },
            
            'drink.title': { zh: '‰∏é‰ªôÂØπÈ•Æ', en: 'Drink with Li Bai' },
            'drink.prompt': { zh: 'ÂÆ¢ÂÆò‰ªäÊó•ÂøÉÊÉÖÂ¶Ç‰ΩïÔºü', en: 'How is your mood today?' },
            'drink.back': { zh: 'ËøîÂõû', en: 'Back' },

            'footprint.title': { zh: 'Ë∂≥ËøπÊº´Ê∏∏', en: 'Journey Map' },
            'footprint.birth': { zh: 'Âá∫Áîü', en: 'Birth' },
            'footprint.out': { zh: 'Âá∫ËúÄ', en: 'Depart' },
            'footprint.capital': { zh: 'ÂÖ•‰∫¨', en: 'Capital' },
            'footprint.war': { zh: 'Êàò‰π±', en: 'War' },
            'footprint.death': { zh: 'Âéª‰∏ñ', en: 'Death' },

            'about.title': { zh: 'ÂÖ≥‰∫éÊàë‰ª¨', en: 'About Us' },
            'about.team': { zh: 'ÊàêÂëòÁªÑÊàê', en: 'Executive Profiles' },
            'about.research': { zh: 'Á†îÁ©∂ÈóÆÈ¢ò‰∏éÂäûÊ≥ï', en: 'Research Questions And Methods' },
            'about.findings': { zh: 'Á†îÁ©∂ÁªìÊûú', en: 'Research Findings' },
            'about.sources': { zh: 'Êï∞ÊçÆÊù•Ê∫ê', en: 'Data Sources' },
            'about.data': { zh: 'Êï∞ÊçÆ‰∏ãËΩΩ', en: 'Data Download' },
            'about.download_btn': { zh: '‰∏ãËΩΩÊï∞ÊçÆÈõÜ (GitHub)', en: 'Download Dataset (GitHub)' },
        };

        const TYPEWRITER_PHRASES = {
            zh: ["Ê∏∏ÂéÜÂõõÊñπ", "ËØóÈõÜÂàõ‰Ωú", "ÊÉÖÊÑüË°®Ëææ"],
            en: ["Wandering the World", "Creating Poetry", "Expressing Emotions"]
        };

        const JOURNEY_DATA = [
            { y: 701, n: 'Á¢éÂè∂Âüé', lat: 42.8447, lng: 75.1648 }, { y: 705, n: 'Ê±üÊ≤π (ËúÄ‰∏≠)', lat: 31.7828, lng: 104.7570 },
            { y: 718, n: 'Êà¥Â§©Â±±', lat: 31.81, lng: 104.70 }, { y: 720, n: 'ÊàêÈÉΩ', lat: 30.5728, lng: 104.0668 },
            { y: 724, n: 'Â≥®ÁúâÂ±±', lat: 29.5807, lng: 103.3592 }, { y: 725, n: 'Ê∏ùÂ∑û', lat: 29.5627, lng: 106.5528 },
            { y: 725, n: 'ËçÜÈó®', lat: 30.5667, lng: 111.4500 }, { y: 726, n: 'Ê±üÂ§è', lat: 30.5484, lng: 114.3168 },
            { y: 726, n: 'ÈáëÈôµ', lat: 32.0415, lng: 118.7781 }, { y: 726, n: 'Êâ¨Â∑û', lat: 32.3934, lng: 119.4290 },
            { y: 727, n: 'ÂÆâÈôÜ', lat: 31.3653, lng: 113.7077 }, { y: 730, n: 'ÈïøÂÆâ', lat: 34.2652, lng: 108.9500 },
            { y: 731, n: 'Ê¥õÈò≥', lat: 34.6197, lng: 112.4540 }, { y: 732, n: 'Âπ∂Â∑û', lat: 37.8706, lng: 112.5489 },
            { y: 735, n: 'Ê¥õÈò≥', lat: 34.6197, lng: 112.4540 }, { y: 742, n: 'ÈïøÂÆâ (Áø∞Êûó)', lat: 34.2652, lng: 108.9500 },
            { y: 744, n: 'Ê¥õÈò≥ (ÈÅáÊùúÁî´)', lat: 34.6197, lng: 112.4540 }, { y: 745, n: 'ÂÖñÂ∑û', lat: 35.5531, lng: 116.8261 },
            { y: 746, n: 'Ë∂ä‰∏≠', lat: 30.0024, lng: 120.5753 }, { y: 750, n: 'ÂπΩÂ∑û', lat: 39.9042, lng: 116.4074 },
            { y: 752, n: 'ÂÆ£Âüé', lat: 30.9407, lng: 118.7587 }, { y: 753, n: 'ÁßãÊµ¶', lat: 30.6500, lng: 117.4800 },
            { y: 755, n: 'ÈáëÈôµ', lat: 32.0415, lng: 118.7781 }, { y: 756, n: 'Â∫êÂ±±', lat: 29.5910, lng: 115.9922 },
            { y: 757, n: 'ÊµîÈò≥', lat: 29.7133, lng: 115.9853 }, { y: 758, n: 'Ê±üÂ§è', lat: 30.5484, lng: 114.3168 },
            { y: 759, n: 'ÁôΩÂ∏ùÂüé (ÈÅáËµ¶)', lat: 31.0450, lng: 109.5780 }, { y: 759, n: 'Ê±üÈôµ', lat: 30.3322, lng: 112.2353 },
            { y: 760, l: 'Ë±´Á´†', lat: 28.6820, lng: 115.8579 }, { y: 761, n: 'ÈáëÈôµ', lat: 32.0415, lng: 118.7781 },
            { y: 762, n: 'ÂΩìÊ∂Ç (ÁªàËÄÅ)', lat: 31.5453, lng: 118.4870 }
        ];

        const EMOTION_MAP_DATA = {
            joy: { label: 'ÂñúÊÇ¶‰∏éÊ¨¢‰πê', enLabel: 'Joy & Happiness', color: 'orange', points: [{ lat: 31.78, lng: 104.73, intensity: 1.0, period: 'youth' }, { lat: 32.39, lng: 119.42, intensity: 1.0, period: 'middle' }, { lat: 31.04, lng: 109.58, intensity: 1.5, period: 'old' }, { lat: 30.95, lng: 118.75, intensity: 0.8, period: 'middle' }] },
            sadness: { label: 'ÂìÄÊÄ®‰∏éÊÇ≤‰º§', enLabel: 'Sorrow & Sadness', color: 'blue', points: [{ lat: 31.55, lng: 118.48, intensity: 1.5, period: 'old' }, { lat: 28.15, lng: 107.05, intensity: 1.0, period: 'old' }, { lat: 34.25, lng: 108.98, intensity: 0.8, period: 'middle' }, { lat: 30.38, lng: 114.32, intensity: 1.0, period: 'old' }] },
            ambition: { label: 'Ë±™Êîæ‰∏éÊøÄÊòÇ', enLabel: 'Ambition & Passion', color: 'red', points: [{ lat: 34.22, lng: 108.96, intensity: 1.5, period: 'middle' }, { lat: 30.67, lng: 104.07, intensity: 1.0, period: 'youth' }, { lat: 35.41, lng: 116.59, intensity: 0.8, period: 'middle' }, { lat: 34.62, lng: 112.45, intensity: 0.9, period: 'middle' }] },
            loneliness: { label: 'Â≠§ÂØÇ‰∏éËêΩÂØû', enLabel: 'Loneliness', color: 'grey', points: [{ lat: 30.95, lng: 118.75, intensity: 1.5, period: 'middle' }, { lat: 31.43, lng: 113.75, intensity: 0.9, period: 'middle' }, { lat: 32.04, lng: 118.78, intensity: 1.0, period: 'old' }] },
            nostalgia: { label: 'ÊÄù‰π°‰∏éÊÄÄÂè§', enLabel: 'Nostalgia', color: 'purple', points: [{ lat: 32.04, lng: 118.78, intensity: 1.2, period: 'middle' }, { lat: 32.39, lng: 119.42, intensity: 0.9, period: 'middle' }, { lat: 30.33, lng: 112.20, intensity: 1.0, period: 'youth' }] },
            friendship: { label: 'ÂèãÊÉÖ‰∏éÁü•Â∑±', enLabel: 'Friendship', color: 'green', points: [{ lat: 34.62, lng: 112.45, intensity: 1.5, period: 'middle' }, { lat: 32.39, lng: 119.42, intensity: 1.0, period: 'middle' }, { lat: 31.55, lng: 118.48, intensity: 0.8, period: 'old' }, { lat: 30.95, lng: 118.75, intensity: 0.9, period: 'middle' }] },
        };

        const ANALYTICS_DATA_FULL = [
            { name: 'Êúà‰∫Æ', enName: 'Moon', value: 120, emotion: 'ÊÄù‰π°/Â≠§Áã¨', enEmotion: 'Nostalgia/Loneliness', color: '#08306b' },
            { name: 'Â±±', enName: 'Mountain', value: 110, emotion: 'ÂΩíÈöê/Â£ÆÈòî', enEmotion: 'Reclusion/Grandeur', color: '#08519c' },
            { name: 'ÈÖí', enName: 'Wine', value: 95, emotion: 'Ë±™Ëøà/Ëß£Âøß', enEmotion: 'Boldness/Relief', color: '#2171b5' },
            { name: 'Ê∞¥', enName: 'Water', value: 85, emotion: 'ÊµÅÈÄù/ÊÑÅËã¶', enEmotion: 'Passing/Sorrow', color: '#4292c6' },
            { name: 'Ëä±', enName: 'Flower', value: 60, emotion: 'ÁæéÂ•Ω/ÊòìÈÄù', enEmotion: 'Beauty/Fleeting', color: '#6baed6' },
            { name: 'Â≠§', enName: 'Solitary', value: 55, emotion: 'ÂØÇÂØû', enEmotion: 'Loneliness', color: '#9ecae1' },
            { name: 'Ââë', enName: 'Sword', value: 40, emotion: '‰æ†ÂÆ¢/Êä±Ë¥ü', enEmotion: 'Chivalry/Ambition', color: '#c6dbef' },
            { name: 'Ê¢¶', enName: 'Dream', value: 30, emotion: 'ËôöÂπª', enEmotion: 'Illusion', color: '#deebf7' }
        ];

        const TOTAL_VALUE = ANALYTICS_DATA_FULL.reduce((a,b)=>a+b.value,0);

        const DRINK_DATA = {
            "Ë±™ÊÉÖ‰∏á‰∏à": { moodKey: 'ambitious', poem: "È£ûÊµÅÁõ¥‰∏ã‰∏âÂçÉÂ∞∫ÔºåÁñëÊòØÈì∂Ê≤≥ËêΩ‰πùÂ§©ÔºÅ", img: "https://raw.githubusercontent.com/seblee424/libai_emotin_data/main/È£ûÊµÅÁõ¥‰∏ã.jpg", desc: "„ÄäÊúõÂ∫êÂ±±ÁÄëÂ∏É„Äã" },
            "ÊÄùÂøµÊïÖ‰π°": { moodKey: 'homesick', poem: "‰∏æÂ§¥ÊúõÊòéÊúàÔºå‰ΩéÂ§¥ÊÄùÊïÖ‰π°„ÄÇ", img: "https://raw.githubusercontent.com/seblee424/libai_emotin_data/main/ÊòéÊúàÊÄùÊÉ≥.jpg", desc: "„ÄäÈùôÂ§úÊÄù„Äã" },
            "ÊÄÄÊâç‰∏çÈÅá": { moodKey: 'frustrated', poem: "Â§©ÁîüÊàëÊùêÂøÖÊúâÁî®ÔºåÂçÉÈáëÊï£Â∞ΩËøòÂ§çÊù•„ÄÇ", img: "https://raw.githubusercontent.com/seblee424/libai_emotin_data/main/ÊÄÄÊâç‰∏çÈÅá.jpg", desc: "„ÄäÂ∞ÜËøõÈÖí„Äã" },
            "‰∫´ÂèóËá™ÁÑ∂": { moodKey: 'nature', poem: "‰∏§Â≤∏ÁåøÂ£∞Âïº‰∏ç‰ΩèÔºåËΩªËàüÂ∑≤Ëøá‰∏áÈáçÂ±±„ÄÇ", img: "https://raw.githubusercontent.com/seblee424/libai_emotin_data/main/ËΩªËàüÂ∑≤Ëøá.jpg", desc: "„ÄäÊó©ÂèëÁôΩÂ∏ùÂüé„Äã" },
            "ÊÑüÂèπÊó∂ÂÖâ": { moodKey: 'time', poem: "ÂºÉÊàëÂéªËÄÖÔºåÊò®Êó•‰πãÊó•‰∏çÂèØÁïôÔºõ‰π±ÊàëÂøÉËÄÖÔºå‰ªäÊó•‰πãÊó•Â§öÁÉ¶Âøß„ÄÇ", img: "https://raw.githubusercontent.com/seblee424/libai_emotin_data/main/ÊÑüÂèπÊó∂ÂÖâ.jpg", desc: "„ÄäÂÆ£Â∑ûË∞¢ÊúìÊ•ºÈ•ØÂà´Ê†°‰π¶Âèî‰∫ë„Äã" }
        };

        const MOOD_TRANSLATIONS = {
            "Ë±™ÊÉÖ‰∏á‰∏à": "Ambitious",
            "ÊÄùÂøµÊïÖ‰π°": "Homesick",
            "ÊÄÄÊâç‰∏çÈÅá": "Unappreciated",
            "‰∫´ÂèóËá™ÁÑ∂": "Enjoying Nature",
            "ÊÑüÂèπÊó∂ÂÖâ": "Lamenting Time"
        };

        const LIFE_EVENTS = [
            {y:'701',t:{zh:'Á¢éÂè∂ÈôçÁîü',en:'Birth in Suyab'},d:{zh:'Âá∫Áîü‰∫éÁ¢éÂè∂Âüé„ÄÇ',en:'Born in Suyab (modern day Kyrgyzstan).'}},
            {y:'724',t:{zh:'‰ªóÂâëÂéªÂõΩ',en:'Leaving Home'},d:{zh:'Ëæû‰∫≤ËøúÊ∏∏ÔºåÂá∫‰∏âÂ≥°„ÄÇ',en:'Left home to travel, passing through the Three Gorges.'}},
            {y:'742',t:{zh:'Áø∞Êûó‰æõÂ•â',en:'Imperial Academy'},d:{zh:'ÂÖ•‰∫¨‰æõÂ•âÁø∞Êûó„ÄÇ',en:'Summoned to the capital as a Hanlin scholar.'}},
            {y:'744',t:{zh:'ËµêÈáëÊîæËøò',en:'Leaving Capital'},d:{zh:'Á¶ªÂºÄÈïøÂÆâÔºåÈÅáÊùúÁî´„ÄÇ',en:'Left Chang\'an, met Du Fu.'}},
            {y:'755',t:{zh:'ÈÅø‰π±Ê±üÂçó',en:'Fleeing War'},d:{zh:'ÂÆâÂè≤‰πã‰π±ÁàÜÂèë„ÄÇ',en:'An Lushan Rebellion broke out.'}},
            {y:'762',t:{zh:'ÊèΩÊúàÈïøÁú†',en:'Final Rest'},d:{zh:'ÁóÖÈÄù‰∫éÂΩìÊ∂Ç„ÄÇ',en:'Passed away in Dangtu.'}}
        ];

        const TEAM_MEMBERS = [
            { 
                name: { zh: 'Êùé‰Ω≥ÁÉ®', en: 'Li Jiaye' }, 
                title: { zh: 'È°πÁõÆÁªèÁêÜ', en: 'Project Manager' }, 
                avatar: 'https://github.com/Yang-lab1/CHC-final/blob/main/picture/li_jiaye.jpg?raw=true',
                email: 'lijiayeee@126.com',
                linkedin: 'linkedin.com/in/jiaye-li-248784381'
            },
            { 
                name: { zh: 'ÊùéÂ≠êÁùø', en: 'Li Zirui' }, 
                title: { zh: 'AIÂ∑•Á®ãÂ∏à', en: 'AI Engineer' }, 
                avatar: 'https://github.com/Yang-lab1/CHC-final/blob/main/picture/li_zirui.jpg?raw=true',
                email: '25044237g@connect.polyu.hk',
                linkedin: 'linkedin.com/in/zi-rui-li-853ba0382'
            },
            { 
                name: { zh: 'ÈôàÂ©ßÂ©ß', en: 'Chen Jingjing' }, 
                title: { zh: '‰∫∫Êñá‰∏ìÂÆ∂', en: 'Humanities Expert' }, 
                avatar: 'https://github.com/Yang-lab1/CHC-final/blob/main/picture/chen_jingjing.jpg?raw=true',
                email: 'jocelynchen1225@gmail.com',
                linkedin: 'linkedin.com/in/jingjing-chen-619925381'
            },
            { 
                name: { zh: 'ÊûóÊù®', en: 'Lin Yang' }, 
                title: { zh: 'ÊäÄÊúØ‰∏ìÂÆ∂„ÄÅËΩØ‰ª∂Â∑•Á®ãÂ∏à', en: 'Technical Experts, Software Engineers)' }, 
                avatar:  'https://github.com/Yang-lab1/CHC-final/blob/main/picture/lin_yang.jpg?raw=true',
                email: 'lin297861138@gmail.com',
                linkedin: 'linkedin.com/in/yang-lin-3b1b09381'
            },
            { 
                name: { zh: 'ÈªéÂΩ¶‰º∂', en: 'Li Yanling' }, 
                title: { zh: 'Êï∞ÊçÆÊî∂ÈõÜÂíåÂ§ÑÁêÜÂàÜÊûêÂ∑•Á®ãÂ∏à', en: 'Data Collection & Processing Analysis Engineer' }, 
                avatar: 'https://github.com/Yang-lab1/CHC-final/blob/main/picture/li_yanlin.jpg?raw=true',
                email: 'lynn27149.li@gmail.com',
                linkedin: 'linkedin.com/in/yanling-li-b05359331'
            },
            { 
                name: { zh: 'ËÅÇÂ∞îÂçì', en: 'Nie Erzhuo' }, 
                title: { zh: 'ÂÖ®ÁêÉËê•ÈîÄ', en: 'Global Marketing' }, 
                avatar: 'https://github.com/Yang-lab1/CHC-final/blob/main/picture/nie_erzhuo.jpg?raw=true',
                email: '1849083010n@gmail.com',
                linkedin: 'linkedin.com/in/erzhuo-nie-ab7bb6381'
            },
            { 
                name: { zh: 'ÁôΩÂÆ∂Ê†ë', en: 'Bai Jiashu' }, 
                title: { zh: 'Êï∞ÊçÆÂàÜÊûêÂ∏à„ÄÅ‰∫∫Êñá‰∏ìÂÆ∂', en: 'Data Analyst, Humanities Expert' }, 
                avatar: 'https://github.com/Yang-lab1/CHC-final/blob/main/picture/bai_jiashu.jpg?raw=true',
                email: '25116581g@connect.polyu.hk',
                linkedin: 'linkedin.com/in/kashupak'
            },
            { 
                name: { zh: 'ÊùéÁôΩ', en: 'Li Bai' }, 
                title: { zh: 'ËØó‰∫∫ & Ê∏∏Â≠ê', en: 'Poet & Wanderer' }, 
                avatar: 'https://picx.zhimg.com/80/v2-7228406e00cce3ede863a49268a98993_720w.webp?source=2c26e567',
                email: 'libai@tang-dynasty.gov',
                linkedin: 'linkedin.com/in/libai-poet'
            },
        ];

// ‚ùå ÊâæÂà∞‰Ω†ÂéüÊù•ÁöÑËøôÂá†Ë°åÈîô‰ª£Á†ÅÔºàÂú® TEAM_MEMBERS ‰∏ãÈù¢ÔºâÔºåÂà†ÊéâÂÆÉ‰ª¨ÔºåÊç¢Êàê‰∏ãÈù¢ÁöÑÔºö

        const RESEARCH_OVERVIEW = {
            zh: "Êú¨È°πÁõÆÊó®Âú®ÈÄöËøáÂú∞ÁêÜ‰ø°ÊÅØÁ≥ªÁªüÔºàGISÔºâ‰∏éËá™ÁÑ∂ËØ≠Ë®ÄÂ§ÑÁêÜÔºàNLPÔºâÊäÄÊúØÔºåÊï∞Â≠óÂåñÈáçÊûÑÂîê‰ª£ËØó‰∫∫ÊùéÁôΩ‰∏ÄÁîüÁöÑÊó∂Á©∫ËΩ®Ëøπ‰∏éÊÉÖÊÑüÂõæË∞±„ÄÇÈÄöËøáÂØπÊùéÁôΩÁé∞Â≠òÂçÉ‰ΩôÈ¶ñËØó‰ΩúËøõË°åÊ∑±Â∫¶ÊñáÊú¨ÊåñÊéòÔºåÊàë‰ª¨ÊèêÂèñ‰∫ÜÂÖ∂‰∏≠Ëï¥Âê´ÁöÑÊÉÖÊÑüÂÖ≥ÈîÆËØç‰∏éÂú∞ÁêÜÂêçËØçÔºåÂπ∂Âà©Áî®ÂéÜÂè≤Âú∞ÁêÜÊï∞ÊçÆÂ∫ìËøõË°åÁ≤æÁ°ÆÁöÑÁ©∫Èó¥ÂÆö‰Ωç„ÄÇÁ†îÁ©∂‰∏ç‰ªÖÂèØËßÜÂåñ‰∫ÜËØó‰∫∫‚Äú‰ªóÂâëÂéªÂõΩ‚ÄùÁöÑÂ£ÆÊ∏∏Ë∑ØÁ∫øÔºåÊõ¥Ê∑±ÂÖ•Êé¢ËÆ®‰∫ÜÂú∞ÁêÜÁéØÂ¢ÉÂèòÂåñÂ¶Ç‰ΩïÈáçÂ°ëËØó‰∫∫ÁöÑÂàõ‰ΩúÂøÉÂ¢ÉÔºå‰ª•ÂèäÊîøÊ≤ªÊ≤âÊµÆÂØºËá¥ÁöÑÊÉÖÊÑü-Âú∞ÁêÜÂº∫ÂÖ≥ËÅîÊÄß„ÄÇÊàë‰ª¨ËØïÂõæÂõûÁ≠îÔºöÁâ©ÁêÜÁ©∫Èó¥ÁöÑÁßªÂä®Â¶Ç‰ΩïÊò†Â∞ÑÂà∞Á≤æÁ•û‰∏ñÁïåÁöÑÊ≥¢ÊæúÔºüÁõõÂîêÁöÑÂ£Æ‰∏ΩÂ±±Ê≤≥Â¶Ç‰ΩïÂú®ËØóÊ≠åÊÑèË±°‰∏≠Ê≤âÊ∑Ä‰∏∫Ê∞∏ÊÅíÁöÑÊñáÂ≠¶Âú∞ÁêÜÁ¨¶Âè∑ÔºüËøô‰∏ÄÁ†îÁ©∂‰∏∫ÁêÜËß£‰∏≠ÂõΩÂè§ÂÖ∏ÊñáÂ≠¶Êèê‰æõ‰∫ÜÂÖ®Êñ∞ÁöÑÂÆöÈáèÂåñ‰∏éÂèØËßÜÂåñËßÜËßí„ÄÇ",
            en: "This project aims to digitally reconstruct the spatiotemporal trajectory and emotional landscape of Li Bai, the most prominent poet of the Tang Dynasty, by integrating advanced Geographic Information Systems (GIS) with Natural Language Processing (NLP) techniques. We conducted a comprehensive text mining analysis on over one thousand of his surviving poems to extract emotional keywords and specific geographical references, mapping them against historical geographic databases. Our research not only visualizes the poet's extensive travel routes across 8th-century China but also investigates how shifting geographical environments influenced his creative sentiment. Furthermore, we analyze the strong correlation between his emotional states and spatial location, particularly in the context of his political fluctuations‚Äîfrom imperial favor in the capital to exile in the remote southwest. By answering how physical movement maps onto spiritual experience, this study offers a novel quantitative perspective for interpreting the interplay between geography and literature in Chinese classical poetry."
        };

        const RESEARCH_FINDINGS = {
            zh: "Á†îÁ©∂ÂèëÁé∞ÔºåÊùéÁôΩÁöÑÊÉÖÊÑüË°®Ëææ‰∏éÂú∞ÁêÜ‰ΩçÁΩÆÂëàÁé∞ÊòæËëóÁöÑÁõ∏ÂÖ≥ÊÄß„ÄÇÂú®ÈïøÂÆâÊó∂ÊúüÔºå‰ªñÁöÑËØó‰ΩúÂ§ö‰ΩìÁé∞Ë±™Ëøà‰∏éËá™‰ø°ÔºõËÄåÂú®ÊµÅÊîæÂ§úÈÉéÈÄî‰∏≠ÔºåÊÇ≤ÊÑ§‰∏éÊÄù‰π°‰πãÊÉÖËææÂà∞È°∂Â≥∞„ÄÇÈÄöËøáÊÉÖÊÑüÁÉ≠ÂäõÂõæÔºåÊàë‰ª¨Ê∏ÖÊô∞Âú∞ÁúãÂà∞‰∫ÜËØó‰∫∫ÊÉÖÁª™ÈöèÁ©∫Èó¥ËΩ¨ÁßªÁöÑÂä®ÊÄÅÂèòÂåñËΩ®Ëøπ„ÄÇÊ≠§Â§ñÔºåÈáèÂåñÂàÜÊûêÊòæÁ§∫‚ÄúÊúà‚Äù„ÄÅ‚ÄúÈÖí‚Äù„ÄÅ‚ÄúÊ∞¥‚ÄùÊòØ‰ªñËØóÊ≠å‰∏≠Âá∫Áé∞È¢ëÁéáÊúÄÈ´òÁöÑ‰∏âÂ§ßÊ†∏ÂøÉÊÑèË±°ÔºåÊûÑÂª∫‰∫ÜÂÖ∂Áã¨ÁâπÁöÑÊµ™Êº´‰∏ª‰πâÁ¨¶Âè∑Á≥ªÁªü„ÄÇ",
            en: "The study reveals a significant correlation between Li Bai's emotional expression and his geographical location. During his time in Chang'an, his poems often reflected boldness and confidence, while during his exile to Yelang, sentiments of indignation and nostalgia peaked. Through the emotional heatmap, we clearly visualize the dynamic trajectory of the poet's mood shifting with space. Furthermore, quantitative analysis shows that 'Moon', 'Wine', and 'Water' are the three most frequent core images, constructing his unique romantic symbol system.."
        };

        const DATA_SOURCES = [
            {
                title: { zh: "1. Âè§Á±çÊï∞Â≠óËµÑÊ∫êÔºö„ÄäÊùéÂ§™ÁôΩÈõÜÊ≥®„ÄãÔºàÂç∑‰∏âÂçÅ‰∫îÔºöÊùéÂ§™ÁôΩÂπ¥Ë∞±Ôºâ", en: "1. Ancient Text Resources: Annotated Collection of Li Bai's Works (Vol. 35)" },
                desc: "Wang, Q. (Qing Dynasty). Li Taibai Ji Zhu( 35: Li Taibai Nian Pu) [Annotated collection of Li Bai's works (Vol. 35: Chronological biography of Li Bai)]. Chinese Text Project. https://ctext.org/wiki.pl?if=en&chapter=886336&remap=gb"
            },
            {
                title: { zh: "2. Êï∞Â≠óÂèØËßÜÂåñËµÑÊ∫êÔºöÂîêÂÆãÊñáÂ≠¶ÁºñÂπ¥Âú∞ÂõæÔºàÊùéÁôΩ‰∏ìÈ¢òÔºâ", en: "2. Digital Visualization Resources: Chronological Literary Map of Tang and Song" },
                desc: "Suzhou Tupu Information Technology Co., Ltd. (2025). T√°ng S√≤ng W√©nxu√© BiƒÅnni√°n D√¨t√∫ - L«ê B√°i [Chronological literary map of Tang and Song dynasties - Li Bai] (Interactive digital map) [Data support: Wang, Z. P.]. CNKGraph. https://cnkgraph.com/Map/PoetLife?author=%e6%9d%8e%e7%99%bd"
            }
        ];

        const PERIODS = [
            { id: 'all', label: {zh: 'ÂÖ®ÈÉ®', en: 'All'} },
            { id: 'youth', label: {zh: 'ÈùíÂπ¥Êúü', en: 'Youth'} },
            { id: 'middle', label: {zh: '‰∏≠Âπ¥Êúü', en: 'Middle Age'} },
            { id: 'old', label: {zh: 'ËÄÅÂπ¥Êúü', en: 'Old Age'} }
        ];

        const POEM_DATABASE = [
            { y: 718, l: "Êà¥Â§©Â±±", m: "ÈöêÈÄ∏", t: "ËÆøÊà¥Â§©Â±±ÈÅìÂ£´‰∏çÈÅá" }, { y: 720, l: "ÊàêÈÉΩ", m: "Ë±™Ëøà", t: "ÁôªÈî¶ÂüéÊï£Ëä±Ê•º" },
            { y: 724, l: "Â≥®ÁúâÂ±±", m: "ÊÄù‰π°", t: "Â≥®ÁúâÂ±±ÊúàÊ≠å" }, { y: 725, l: "Ê∏ùÂ∑û", m: "Ë±™Ëøà", t: "Â≥®ÁúâÂ±±ÊúàÊ≠åÈÄÅËúÄÂÉßÊôèÂÖ•‰∏≠‰∫¨" },
            { y: 725, l: "ËçÜÈó®", m: "Â£ÆÈòî", t: "Ê∏°ËçÜÈó®ÈÄÅÂà´" }, { y: 726, l: "Êâ¨Â∑û", m: "ÊÄù‰π°", t: "ÈùôÂ§úÊÄù" },
            { y: 726, l: "Êâ¨Â∑û", m: "ÊÑÅËã¶", t: "ÁßãÊµ¶Ê≠å" }, { y: 727, l: "ÂÆâÈôÜ", m: "ÂΩíÈöê", t: "Â±±‰∏≠ÈóÆÁ≠î" },
            { y: 727, l: "ÂÆâÈôÜ", m: "Ë±™Ëøà", t: "‰ª£ÂØøÂ±±Á≠îÂ≠üÂ∞ëÂ∫ú" }, { y: 728, l: "Â∫êÂ±±", m: "Â£ÆÈòî", t: "ÊúõÂ∫êÂ±±ÁÄëÂ∏É" },
            { y: 730, l: "ÈïøÂÆâ", m: "Â§±ÊÑè", t: "ÁéâÁúüÂÖ¨‰∏ªÂà´È¶ÜËã¶Èõ®" }, { y: 731, l: "Ê¥õÈò≥", m: "ÊÄù‰π°", t: "Êò•Â§úÊ¥õÂüéÈóªÁ¨õ" },
            { y: 732, l: "Â§™Âéü", m: "ÊÄÄÂè§", t: "Â§™ÂéüÊó©Áßã" }, { y: 735, l: "Ê¥õÈò≥", m: "ÂèãÊÉÖ", t: "Ëµ†Â≠üÊµ©ÁÑ∂" },
            { y: 738, l: "ÂçóÈò≥", m: "Ë±™Ëøà", t: "ÂçóÈò≥ÈÄÅÂÆ¢" }, { y: 742, l: "ÈïøÂÆâ", m: "ÂæóÊÑè", t: "È©æÂéªÊ∏©Ê≥âÂêéËµ†Êù®Â±±‰∫∫" },
            { y: 742, l: "ÈïøÂÆâ", m: "Ë±™Ëøà", t: "ÂçóÂ•î‰π¶ÊÄÄ" }, { y: 743, l: "ÈïøÂÆâ", m: "Ë±™Ëøà", t: "Ê∏ÖÂπ≥Ë∞É" },
            { y: 743, l: "ÈïøÂÆâ", m: "ÁæéÂ•Ω", t: "ÂÆ´‰∏≠Ë°å‰πêËØç" }, { y: 744, l: "ÈïøÂÆâ", m: "Â≠§Áã¨", t: "Êúà‰∏ãÁã¨ÈÖå" },
            { y: 744, l: "ÈïøÂÆâ", m: "ÊÑÅËã¶", t: "Ë°åË∑ØÈöæ" }, { y: 744, l: "Ê¥õÈò≥", m: "ÂèãÊÉÖ", t: "Ëµ†ÊùúÁî´" },
            { y: 744, l: "Ê¥õÈò≥", m: "ÂèãÊÉÖ", t: "È≤ÅÈÉ°‰∏úÁü≥Èó®ÈÄÅÊùú‰∫åÁî´" }, { y: 745, l: "Â§©Âß•Â±±", m: "ËôöÂπª", t: "Ê¢¶Ê∏∏Â§©Âß•ÂêüÁïôÂà´" },
            { y: 747, l: "ÈáëÈôµ", m: "Ë±™Ëøà", t: "ÈáëÈôµÈÖíËÇÜÁïôÂà´" }, { y: 748, l: "Êâ¨Â∑û", m: "ÈÄÅÂà´", t: "ÈªÑÈπ§Ê•ºÈÄÅÂ≠üÊµ©ÁÑ∂‰πãÂπøÈôµ" },
            { y: 749, l: "ÈáëÈôµ", m: "Ë±™Ëøà", t: "Â∫êÂ±±Ë∞£ÂØÑÂç¢‰æçÂæ°ËôöËàü" }, { y: 750, l: "ÈáëÈôµ", m: "Ë±™Ëøà", t: "Â∞ÜËøõÈÖí" },
            { y: 750, l: "ÂÆ£Âüé", m: "Èó≤ÈÄÇ", t: "ÂØÑÈü¶ÂçóÈôµÂÜ∞" }, { y: 752, l: "ÂπΩÂ∑û", m: "ÊÇ≤ÊÑ§", t: "ÂåóÈ£éË°å" },
            { y: 753, l: "ÂÆ£Âüé", m: "Â≠§Áã¨", t: "Áã¨ÂùêÊï¨‰∫≠Â±±" }, { y: 753, l: "ÂÆ£Âüé", m: "ÊÑÅËã¶", t: "ÂÆ£Â∑ûË∞¢ÊúìÊ•ºÈ•ØÂà´Ê†°‰π¶Âèî‰∫ë" },
            { y: 754, l: "ÁßãÊµ¶", m: "ÊÑÅËã¶", t: "ÁßãÊµ¶Ê≠åÂçÅ‰∏ÉÈ¶ñ" }, { y: 754, l: "ÂΩìÊ∂Ç", m: "ÂèãÊÉÖ", t: "Ëµ†Ê±™‰º¶" },
            { y: 755, l: "ÈáëÈôµ", m: "ÂøßÊÑÅ", t: "ÁôªÈáëÈôµÂá§Âá∞Âè∞" }, { y: 756, l: "Â∫êÂ±±", m: "ÊÇ≤ÊÑ§", t: "Ê∞∏Áéã‰∏úÂ∑°Ê≠å" },
            { y: 757, l: "ÊµîÈò≥", m: "ÊÇ≤ÊÑ§", t: "‰∏äÁöáË•øÂ∑°Âçó‰∫¨Ê≠å" }, { y: 758, l: "Ê±üÂ§è", m: "ÂèãÊÉÖ", t: "Ê±üÂ§èÂà´ÂÆã‰πãÊÇå" },
            { y: 759, l: "ÁôΩÂ∏ùÂüé", m: "ÂñúÊÇ¶", t: "Êó©ÂèëÁôΩÂ∏ùÂüé" }, { y: 759, l: "Ê±üÈôµ", m: "ÊÑÅËã¶", t: "Ê±ü‰∏äÂØÑÂ∑¥‰∏úÊïÖ‰∫∫" },
            { y: 760, l: "Ë±´Á´†", m: "ÊÄù‰π°", t: "Ë±´Á´†Ë°å" }, { y: 761, l: "ÈáëÈôµ", m: "ÊÄÄÂè§", t: "ÈáëÈôµÂüéË•øÊ•ºÊúà‰∏ãÂêü" },
            { y: 761, l: "ÂΩìÊ∂Ç", m: "ÊÇ≤ÊÑ§", t: "‰∏¥Ë∑ØÊ≠å" }, { y: 762, l: "ÂΩìÊ∂Ç", m: "ËææËßÇ", t: "‰∏¥ÁªàÊ≠å" }
        ];

        // --- SERVICE (DeepSeek API Integration) ---
        
        // Securely retrieve the key (Base64 encoded to avoid casual scraping)
        const DEEPSEEK_API_KEY = (function() {
            const encrypted = "c2stNzI5OTc5NDQ0NjZhNGFmMmJjZDUyYTA2ODg5NWY4Y2Y=";
            try {
                return atob(encrypted); // Decode at runtime
            } catch (e) {
                console.error("Key decoding failed");
                return "";
            }
        })();

        const callDeepSeekAPI = async (promptType, params, lang) => {
            if (!DEEPSEEK_API_KEY) {
                return lang === 'zh' ? "APIÈÖçÁΩÆÈîôËØØ: Áº∫Â∞ëÂØÜÈí•„ÄÇ" : "API Configuration Error: Missing Key.";
            }

            const langInstruction = lang === 'en' ? "Please answer in English." : "ËØ∑Áî®‰∏≠ÊñáÂõûÁ≠î„ÄÇ";
            let sys = "", user = params.query || "";

            if (promptType === 'three_ages') {
                sys = `‰Ω†ÊâÆÊºîÊùéÁôΩ„ÄÇËØ∑‰∏•Ê†º„ÄÅÂøÖÈ°ªËæìÂá∫‰∏âÊÆµËØùÔºåÂπ∂‰ΩøÁî® "|||" (‰∏â‰∏™Á´ñÁ∫ø) ‰Ωú‰∏∫ÂàÜÈöîÁ¨¶„ÄÇÊ†ºÂºèÔºöÁ¨¨‰∏ÄÊÆµ|||Á¨¨‰∫åÊÆµ|||Á¨¨‰∏âÊÆµ„ÄÇÁ¨¨‰∏ÄÊÆµÔºöÈùíÂπ¥ÊùéÁôΩÔºàËΩªÁãÇÔºâÔºõÁ¨¨‰∫åÊÆµÔºö‰∏≠Âπ¥ÊùéÁôΩÔºàË±™ËøàÂøßÊÑÅÔºâÔºõÁ¨¨‰∏âÊÆµÔºöËÄÅÂπ¥ÊùéÁôΩÔºàÊ≤ßÊ°ëËææËßÇÔºâ„ÄÇ ${langInstruction}`;
            } else if (promptType === 'general') {
                sys = `‰Ω†ÊòØ‰∏Ä‰ΩçÁ≤æÈÄöÊùéÁôΩÁîüÂπ≥ÁöÑ‰∏ìÂÆ∂AI„ÄÇËØ∑Áî®ÈÄö‰øóÂπΩÈªòÁöÑËØ≠Ë®ÄÂõûÁ≠î„ÄÇ ${langInstruction}`;
            } else if (promptType === 'analysis') {
                sys = `‰Ω†ÊòØ‰∏Ä‰ΩçÂîê‰ª£ÊñáÂ≠¶‰∏ìÂÆ∂„ÄÇËØ∑ÂàÜÊûêÊùéÁôΩÂú®${params.y}Âπ¥‰∫é${params.l}ÂÜôÁöÑ„Ää${params.t}„Äã„ÄÇÊ†ºÂºèÔºö### üìú ÂÖ®ËØóÂëàÁé∞\n(ÈªòÂÜô)\n### üé≠ ÊÉÖÊÑüËß£Êûê\n(ÁªìÂêà${params.m})\n### üåç ÂéÜÂè≤ËÉåÊôØ\n${langInstruction}`;
                user = `ÂàÜÊûê„Ää${params.t}„Äã`;
            }

            try {
                const res = await fetch("https://api.deepseek.com/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json", 
                        "Authorization": `Bearer ${DEEPSEEK_API_KEY}` 
                    },
                    body: JSON.stringify({ 
                        model: "deepseek-chat", 
                        messages: [{role:"system",content:sys},{role:"user",content:user}], 
                        temperature: 0.7 
                    })
                });
                const d = await res.json();
                
                if (d.error) {
                    console.error("DeepSeek API Error:", d.error);
                    return lang === 'zh' ? "API ËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ" : "API request failed, please try again later.";
                }

                return d.choices[0].message.content;
            } catch (e) { 
                console.error("Network Error:", e);
                return lang === 'zh' ? "ÁΩëÁªúËø∑Ë∏™... (API Error)" : "Network lost... (API Error)"; 
            }
        };

        // --- COMPONENTS ---

        const Typewriter = ({ lang }) => {
            const phrases = TYPEWRITER_PHRASES[lang];
            const [index, setIndex] = useState(0);
            const [subIndex, setSubIndex] = useState(0);
            const [reverse, setReverse] = useState(false);

            useEffect(() => {
                setIndex(0);
                setSubIndex(0);
                setReverse(false);
            }, [lang]);

            useEffect(() => {
                if (index >= phrases.length) { setIndex(0); return; }
                const currentPhrase = phrases[index];
                let timeoutValue = 150;
                if (reverse) timeoutValue = 50;
                if (!reverse && subIndex === currentPhrase.length) timeoutValue = 2000;
                if (reverse && subIndex === 0) timeoutValue = 500;
                
                const timer = setTimeout(() => {
                    if (!reverse && subIndex === currentPhrase.length) { setReverse(true); return; }
                    if (reverse && subIndex === 0) { setReverse(false); setIndex((prev) => (prev + 1) % phrases.length); return; }
                    setSubIndex((prev) => prev + (reverse ? -1 : 1));
                }, timeoutValue);
                return () => clearTimeout(timer);
            }, [subIndex, index, reverse, phrases]);

            return (
                <div className="flex flex-col">
                    <h1 className="text-5xl md:text-7xl font-bold tracking-tight leading-tight text-gray-900 mb-2">
                        {T['home.hero.title'][lang]}
                    </h1>
                    <div className="text-5xl md:text-7xl font-bold tracking-tight leading-tight min-h-[1.2em]">
                        <span className="bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-transparent bg-clip-text animate-gradient-x">
                            {phrases[index].substring(0, subIndex)}
                        </span>
                        <span className="ml-1 inline-block w-1 h-12 md:h-16 bg-gray-800 animate-blink align-middle mb-2"></span>
                    </div>
                </div>
            );
        };

        const SearchSection = ({ onSearch, loading, lang }) => {
            const [query, setQuery] = useState('');
            const [mode, setMode] = useState('general');
            const [menuOpen, setMenuOpen] = useState(false);
            const dropdownRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) setMenuOpen(false);
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (query.trim()) onSearch(query, mode);
            };

            return (
                <div className="w-full max-w-2xl mx-auto px-4 relative z-50">
                    <form onSubmit={handleSubmit} className="relative group">
                        <div className="absolute -inset-0.5 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-3xl blur opacity-25 group-hover:opacity-75 transition duration-1000"></div>
                        <div className="relative flex items-center bg-white rounded-3xl leading-none shadow-sm h-16">
                            <div className="relative h-full flex items-center border-r border-gray-100" ref={dropdownRef}>
                                <button type="button" onClick={() => setMenuOpen(!menuOpen)} className="flex items-center gap-2 px-5 h-full text-sm font-bold text-gray-700 hover:text-blue-600 transition-colors whitespace-nowrap bg-gray-50 hover:bg-gray-100 rounded-l-3xl min-w-[120px] justify-between">
                                    {mode === 'general' ? T['search.btn'][lang] : T['search.btn_alt'][lang]}
                                    <span className="text-xs opacity-50">‚ñº</span>
                                </button>
                                {menuOpen && (
                                    <div className="absolute top-full left-0 mt-2 w-full bg-white rounded-xl shadow-xl border border-gray-100 py-1 z-50 overflow-hidden animate-fade-up">
                                        <button type="button" onClick={() => { setMode('general'); setMenuOpen(false); }} className="w-full text-left px-4 py-3 text-sm hover:bg-blue-50">{T['search.btn'][lang]}</button>
                                        <button type="button" onClick={() => { setMode('three_ages'); setMenuOpen(false); }} className="w-full text-left px-4 py-3 text-sm hover:bg-purple-50">{T['search.btn_alt'][lang]}</button>
                                    </div>
                                )}
                            </div>
                            <input type="text" value={query} onChange={e => setQuery(e.target.value)} placeholder={T['search.placeholder'][lang]} className="flex-1 h-full py-2 px-4 text-gray-900 bg-transparent border-0 ring-0 outline-none focus:ring-0 text-lg font-serif placeholder-gray-400" />
                            <button type="submit" disabled={loading} className="px-6 h-full text-blue-600 hover:text-blue-800 transition-colors rounded-r-3xl hover:bg-blue-50 flex items-center justify-center">
                                {loading ? <span className="animate-spin">‚åõ</span> : <span className="text-xl">‚û§</span>}
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        const ChartCanvas = ({ type, data, options }) => {
            const canvasRef = useRef(null);
            const chartInstanceRef = useRef(null);
            useEffect(() => {
                if (canvasRef.current) {
                    if (chartInstanceRef.current) chartInstanceRef.current.destroy();
                    if (window.ChartDataLabels) window.Chart.register(window.ChartDataLabels);
                    chartInstanceRef.current = new window.Chart(canvasRef.current, { type, data, options });
                }
                return () => { if (chartInstanceRef.current) chartInstanceRef.current.destroy(); };
            }, [type, data, options]);
            return <canvas ref={canvasRef} />;
        };

        const EmotionMapPage = ({ viewType, onBack, lang }) => {
            const [activeEmotion, setActiveEmotion] = useState('joy');
            const [activePeriod, setActivePeriod] = useState('all');
            const mapInstanceRef = useRef(null);
            const heatLayerRef = useRef(null);

            const [sY, setSY] = useState(''); const [sL, setSL] = useState(''); const [sM, setSM] = useState(''); const [sT, setST] = useState('');
            const [aiRes, setAiRes] = useState(null); const [aiLoading, setAiLoading] = useState(false);

            const listYears = useMemo(() => [...new Set(POEM_DATABASE.map(i => i.y))].sort(), []);
            const listLocs = useMemo(() => sY ? [...new Set(POEM_DATABASE.filter(i => i.y === Number(sY)).map(i => i.l))] : [], [sY]);
            const listMoods = useMemo(() => sL ? [...new Set(POEM_DATABASE.filter(i => i.y === Number(sY) && i.l === sL).map(i => i.m))] : [], [sY, sL]);
            const listTitles = useMemo(() => sM ? [...new Set(POEM_DATABASE.filter(i => i.y === Number(sY) && i.l === sL && i.m === sM).map(i => i.t))] : [], [sY, sL, sM]);

            const handleAnalyze = async () => {
                setAiLoading(true);
                const res = await callDeepSeekAPI('analysis', { y: sY, l: sL, m: sM, t: sT }, lang);
                setAiRes(res);
                setAiLoading(false);
            };

            useEffect(() => {
                if (viewType !== 'map') return;
                const timer = setTimeout(() => {
                    if (!mapInstanceRef.current && window.L && document.getElementById('em-map')) {
                        const m = window.L.map('em-map', { center: [33.0, 110.0], zoom: 5, zoomControl: false, attributionControl: false });
                        window.L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(m);
                        mapInstanceRef.current = m;
                    }
                    if (mapInstanceRef.current) {
                        const m = mapInstanceRef.current;
                        if (heatLayerRef.current) heatLayerRef.current.remove();
                        const category = EMOTION_MAP_DATA[activeEmotion];
                        const pts = category.points.filter(p => activePeriod === 'all' || p.period === activePeriod).map(p => [p.lat, p.lng, p.intensity]);

                        let gradient = { 0.3: 'blue', 0.5: 'lime', 0.7: 'yellow', 1.0: 'red' };
                        if (category.color === 'orange') gradient = { 0.2: '#fbbf24', 0.6: '#f59e0b', 1: '#b45309' };
                        if (category.color === 'red') gradient = { 0.2: '#f87171', 0.6: '#dc2626', 1: '#991b1b' };
                        if (category.color === 'grey') gradient = { 0.2: '#9ca3af', 0.6: '#4b5563', 1: '#111827' };
                        if (category.color === 'purple') gradient = { 0.2: '#a78bfa', 0.6: '#7c3aed', 1: '#4c1d95' };
                        if (category.color === 'green') gradient = { 0.2: '#34d399', 0.6: '#059669', 1: '#064e3b' };

                        if (window.L.heatLayer) heatLayerRef.current = window.L.heatLayer(pts, { radius: 50, blur: 30, max: 2.0, minOpacity: 0.65, gradient }).addTo(m);
                    }
                }, 50);
                return () => { clearTimeout(timer); if (mapInstanceRef.current) { mapInstanceRef.current.remove(); mapInstanceRef.current = null; } };
            }, [viewType, activeEmotion, activePeriod]);

            const pieData = useMemo(() => ({
                labels: ANALYTICS_DATA_FULL.map(i => lang === 'zh' ? i.name : i.enName),
                datasets: [{
                    data: ANALYTICS_DATA_FULL.map(i => i.value),
                    backgroundColor: ANALYTICS_DATA_FULL.map(i => i.color),
                    borderWidth: 0
                }]
            }), [lang]);

            const pieOptions = useMemo(() => ({
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    datalabels: {
                        color: '#fff',
                        font: { weight: 'bold', size: 12 },
                        formatter: (value, ctx) => ctx.chart.data.labels[ctx.dataIndex],
                        textShadowColor: 'rgba(0,0,0,0.3)', textShadowBlur: 2
                    }
                }
            }), []);

            return (
                <div className="fixed inset-0 z-50 bg-white flex flex-col">
                    <div className="absolute top-0 left-0 right-0 z-[1000] pointer-events-none flex flex-col md:flex-row justify-between p-4 md:p-6 gap-4">
                        {viewType === 'map' ? (
                            <div className="pointer-events-auto bg-white/95 backdrop-blur shadow-xl rounded-2xl p-5 border border-gray-200 max-w-md w-full flex flex-col gap-5">
                                <div>
                                    <h2 className="text-xl font-bold text-gray-900 font-serif">{T['emotion.title'][lang]}</h2>
                                    <p className="text-xs text-gray-500 mt-1">{T['emotion.subtitle'][lang]}</p>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">{T['emotion.period'][lang]}</label>
                                    <div className="flex bg-gray-100 rounded-lg p-1">
                                        {PERIODS.map(p => (
                                            <button key={p.id} onClick={() => setActivePeriod(p.id)} className={`flex-1 py-1.5 text-xs font-medium rounded-md transition-all ${activePeriod === p.id ? 'bg-white text-blue-700 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>{p.label[lang]}</button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">{T['emotion.core'][lang]}</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {Object.entries(EMOTION_MAP_DATA).map(([key, { label, enLabel, color }]) => (
                                            <button key={key} onClick={() => setActiveEmotion(key)} className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all border ${activeEmotion === key ? 'bg-gray-800 text-white border-gray-800 shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`}>
                                                <span className="w-3 h-3 rounded-full shadow-sm border border-white/20" style={{ backgroundColor: color === 'grey' ? '#374151' : color }}></span>
                                                {lang === 'zh' ? label : enLabel}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        ) : <div></div>}
                        <button onClick={onBack} className="pointer-events-auto h-10 px-4 rounded-full bg-white shadow-lg border border-gray-200 hover:bg-gray-50 text-gray-700 font-medium">‚úï {T['emotion.exit'][lang]}</button>
                    </div>

                    {viewType === 'map' && <div id="em-map" className="w-full h-full relative z-0 bg-stone-50"></div>}

                    {viewType === 'stats' && (
                        <div className="flex-1 relative bg-stone-50 overflow-y-auto custom-scrollbar pt-20 px-6 pb-20">
                            <div className="max-w-6xl mx-auto space-y-12">
                                <div className="text-center mb-8"><h2 className="text-3xl font-bold font-serif text-gray-800">{T['emotion.stats_title'][lang]}</h2></div>

                                <div className="grid md:grid-cols-2 gap-12 items-stretch">
                                    <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-200 h-full flex flex-col items-center justify-between">
                                        <h3 className="text-lg font-bold mb-6 text-gray-800 w-full text-left border-l-4 border-blue-800 pl-3">{T['emotion.fav_words'][lang]}</h3>
                                        <div className="w-full h-72 relative flex justify-center">
                                            <ChartCanvas type="doughnut" data={pieData} options={pieOptions} />
                                        </div>
                                        <div className="w-full mt-6 flex h-5 rounded-full overflow-hidden">
                                            {ANALYTICS_DATA_FULL.map((item, i) => {
                                                const percent = Math.round((item.value / TOTAL_VALUE) * 100);
                                                return (
                                                    <div key={i} className="h-full flex items-center justify-center text-[10px] text-white/90 font-bold" style={{ width: `${percent}%`, background: item.color }} title={`${lang === 'zh' ? item.name : item.enName} ${percent}%`}>
                                                        {percent > 5 ? `${percent}%` : ''}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-200 h-full flex flex-col">
                                        <h3 className="text-lg font-bold mb-6 text-gray-800 border-l-4 border-blue-800 pl-3">{T['emotion.dist'][lang]}</h3>
                                        <div className="space-y-5 flex-1">
                                            {ANALYTICS_DATA_FULL.map((item, idx) => (
                                                <div key={idx} className="group">
                                                    <div className="flex justify-between text-sm mb-2 font-bold text-gray-700">
                                                        <span>{lang === 'zh' ? item.name : item.enName}</span>
                                                        <span>{lang === 'zh' ? item.emotion : item.enEmotion}</span>
                                                    </div>
                                                    <div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden relative" title={`${item.value} (${Math.round((item.value / TOTAL_VALUE) * 100)}%)`}>
                                                        <div className="h-full rounded-full transition-all duration-700 hover:opacity-80 cursor-help" style={{ width: `${(item.value / 120) * 100}%`, backgroundColor: item.color }}></div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden p-8">
                                    <div className="flex items-center gap-2 mb-6 border-b pb-4"><span className="text-2xl">üß†</span><h3 className="font-bold text-gray-800">{T['emotion.ai_title'][lang]}</h3></div>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                        <select className="p-3 rounded-xl border" value={sY} onChange={e => setSY(e.target.value)}><option value="">{T['emotion.select_year'][lang]}</option>{listYears.map(y => <option key={y} value={y}>{y}</option>)}</select>
                                        <select className="p-3 rounded-xl border" value={sL} onChange={e => setSL(e.target.value)} disabled={!sY}><option value="">{T['emotion.select_loc'][lang]}</option>{listLocs.map(l => <option key={l} value={l}>{l}</option>)}</select>
                                        <select className="p-3 rounded-xl border" value={sM} onChange={e => setSM(e.target.value)} disabled={!sL}><option value="">{T['emotion.select_mood'][lang]}</option>{listMoods.map(m => <option key={m} value={m}>{m}</option>)}</select>
                                        <select className="p-3 rounded-xl border" value={sT} onChange={e => setST(e.target.value)} disabled={!sM}><option value="">{T['emotion.select_poem'][lang]}</option>{listTitles.map(t => <option key={t} value={t}>{t}</option>)}</select>
                                    </div>
                                    <button onClick={handleAnalyze} disabled={!sT || aiLoading} className="w-full py-4 bg-gradient-to-r from-blue-800 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition-all disabled:opacity-50">{aiLoading ? T['emotion.analyzing'][lang] : T['emotion.btn_analyze'][lang]}</button>
                                    {aiRes && <div className="mt-8 p-8 bg-[#fdfbf7] rounded-xl border border-stone-200 whitespace-pre-wrap leading-loose font-serif">{aiRes}</div>}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const DrinkPage = ({ onBack, lang }) => {
            const [mood, setMood] = useState("Ë±™ÊÉÖ‰∏á‰∏à");
            const [zoom, setZoom] = useState(false);
            const data = DRINK_DATA[mood];

            return (
                <div className="min-h-screen bg-paper-texture font-serif animate-fade-in flex flex-col">
                    {zoom && <div className="fixed inset-0 z-[200] bg-black/95 flex items-center justify-center cursor-zoom-out p-6" onClick={() => setZoom(false)}><img src={data.img} className="max-w-full max-h-full rounded shadow-2xl animate-slowZoom" alt="Scene" /></div>}
                    <div className="fixed top-0 w-full bg-white/80 backdrop-blur z-20 px-6 py-4 flex justify-between border-b border-gray-200">
                        <h2 className="text-xl font-bold">{T['drink.title'][lang]}</h2>
                        <button onClick={onBack} className="px-4 border rounded-full hover:bg-gray-50">{T['drink.back'][lang]}</button>
                    </div>
                    <div className="flex-1 pt-24 pb-12 px-6 flex flex-col md:flex-row gap-8 max-w-6xl mx-auto w-full">
                        <div className="w-full md:w-1/3 space-y-3">
                            <h3 className="font-bold text-gray-500 mb-4">{T['drink.prompt'][lang]}</h3>
                            {Object.keys(DRINK_DATA).map(k => (
                                <button key={k} onClick={() => setMood(k)} className={`w-full p-4 rounded-xl border text-left flex justify-between transition-all ${mood === k ? 'bg-gray-900 text-white shadow-lg scale-105' : 'bg-white hover:bg-gray-50'}`}>
                                    <span className="font-bold">
                                        {lang === 'zh' ? k : MOOD_TRANSLATIONS[k]}
                                    </span>
                                    {mood === k && 'üç∂'}
                                </button>
                            ))}
                        </div>
                        <div className="w-full md:w-2/3 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden flex flex-col">
                            <div className="h-80 md:h-96 overflow-hidden cursor-zoom-in relative group" onClick={() => setZoom(true)}>
                                <img src={data.img} className="w-full h-full object-cover transition-transform duration-[3s] group-hover:scale-110" alt="Mood" />
                                <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-8">
                                    <h2 className="text-white text-4xl font-bold tracking-widest">{lang === 'zh' ? mood : MOOD_TRANSLATIONS[mood]}</h2>
                                </div>
                            </div>
                            <div className="flex-1 p-10 flex flex-col items-center justify-center text-center bg-[#fffdfa]">
                                <h3 className="text-3xl font-calligraphy mb-4 leading-relaxed">{data.poem}</h3>
                                <p className="text-sm text-gray-400 uppercase tracking-widest mt-4 border-t pt-4">‚Äî‚Äî {data.desc}</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const BaseMap = ({ onL }) => {
            const r = useRef(null);
            useEffect(() => {
                if (!r.current && window.L) {
                    const m = window.L.map('b-m', { center: [33, 110], zoom: 5, zoomControl: false });
                    window.L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(m);
                    r.current = m;
                    if (onL) onL(m);
                }
            }, [onL]);
            return <div id="b-m" className="w-full h-full" />;
        };

        const FootprintPage = ({ onBack, lang }) => {
            const [m, sM] = useState(null);
            const [p, sP] = useState(701);
            const lRef = useRef({});

            // Custom SVG Icon provided
            const markerSvg = `
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="64" height="64" style="filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));">
                <path d="M949.1 501.1c0 35.4-4.2 69.8-12.1 102.8-5.7 23.9-13.6 47.2-23.1 69.4-0.5 1.2-0.9 2.3-1.5 3.3-4.3 9.8-9 19.4-14 28.9-45.2 85.4-117.9 154-206.2 194.1-1.3 0.6-2.6 1.2-4 1.8-53.6 23.6-113 36.8-175.2 36.8-118.9 0-226.7-47.7-305.4-125.2-6.5-6.4-12.7-12.9-18.8-19.6-0.7-0.8-1.5-1.6-2.1-2.4-41.9-47.5-73.7-104-92-166.5-11.4-39.1-17.6-80.5-17.6-123.4 0-27.5 2.5-54.4 7.4-80.4 12.2-65.7 39-126.2 77-178 28.5-39 63.4-73 103-100.6 56.8-39.6 123.6-66.1 195.9-74.8 4.8-0.6 9.6-1 14.4-1.5 12.6-1.2 25.5-1.7 38.5-1.7 80.8 0 156.6 22.1 221.4 60.4 50.7 30 94.8 70.1 129.6 117.3 22.4 30.4 40.9 63.8 54.9 99.5 2 5 3.9 10.2 5.7 15.4 15.7 45.2 24.2 93.8 24.2 144.4z" fill="#FFFFFF" opacity=".4"></path>
                <path d="M893.8 495.6c0 31-3.6 61-10.6 89.8-5 20.9-11.8 41.2-20.1 60.6-0.5 1-0.8 2-1.3 2.9-3.7 8.6-7.8 17-12.2 25.2-39.4 74.6-102.9 134.5-180 169.5-1.1 0.5-2.3 1-3.5 1.6-46.8 20.6-98.6 32.1-153 32.1-103.8 0-197.9-41.6-266.6-109.3-5.6-5.6-11.1-11.2-16.4-17.1-0.6-0.7-1.3-1.4-1.8-2.1-36.6-41.5-64.4-90.9-80.3-145.4-10.1-34.2-15.5-70.4-15.5-107.8 0-24 2.2-47.5 6.5-70.2 10.7-57.3 34.1-110.2 67.2-155.4 24.9-34.1 55.4-63.7 89.9-87.8 49.6-34.6 107.9-57.7 171-65.3 4.2-0.5 8.4-0.9 12.6-1.3 11-1 22.2-1.5 33.6-1.5 70.6 0 136.7 19.3 193.3 52.8 44.3 26.2 82.8 61.2 113.1 102.5 19.6 26.6 35.7 55.7 47.9 86.9 1.7 4.4 3.4 8.9 5 13.4 13.7 39.2 21.2 81.7 21.2 125.9z" fill="#FFFFFF"></path>
                <path d="M282.7 368.668c-3.9-1.5-8.6-0.1-11 3.5l-2.3 5.4-15.9 37.4-11 25.9-19.1 44.8 16.5 7 6.6-15.3 15.1-35.5c-2.7-0.9-4.9-2.9-6.2-5.4-1-2.1-1.4-4.4-0.7-6.9 1.1-4.8 5.5-8.1 10.2-8.1 0.8 0 1.6 0.1 2.4 0.3l2.6 0.6 6.6-15.4 9.7-22.8 2.2-5.2c0.9-4.2-1.5-8.6-5.7-10.3z" fill="#1F0D60"></path>
                <path d="M240 492.768c-4.1 4.5-8.1 9-12.2 13.4-3.1 3.4-6.3 6.9-9.4 10.3 0.7-4.5 1.5-9 2.2-13.4 0.9-5.8 1.9-11.5 2.8-17.3 2.6-0.9 5-1.8 7.6-2.6 0.2 1.5 0.4 3.1 0.5 4.6 1.9-2.7 3.7-5.4 5.7-8.2 1 4.4 1.9 8.8 2.8 13.2z" fill="#D5E0EA"></path>
                <path d="M288.3 379.068l-2.2 5.1-16.6-6.6 2.3-5.4c2.4-3.6 7-5.1 11-3.5 4.1 1.6 6.5 6 5.5 10.4z" fill="#F714FF"></path>
                <path d="M286.1 385.368c-0.1 0-0.2 0-0.4-0.1l-16.6-6.7c-0.5-0.2-0.7-0.7-0.5-1.2 0.2-0.5 0.7-0.7 1.2-0.6l16.6 6.7c0.5 0.2 0.7 0.7 0.5 1.2-0.2 0.5-0.4 0.7-0.8 0.7zM284.6 389.068c-0.1 0-0.2 0-0.4-0.1l-16.6-6.7c-0.5-0.2-0.7-0.7-0.5-1.2 0.2-0.5 0.7-0.7 1.2-0.6l16.6 6.7c0.5 0.2 0.7 0.7 0.5 1.2 0 0.5-0.4 0.7-0.8 0.7z" fill="#D5E0EA"></path>
                <path d="M227.8 506.268c-3.1 3.4-6.3 6.8-9.4 10.2 0.7-4.5 1.5-8.9 2.2-13.3l7.2 3.1z" fill="#1F0D60"></path>
                <path d="M645.031 463.1c2-10.2 4-20.5 5.9-30.7-6.9 1.7-16.1 2.8-24-1.7-22.7-12.9-7.3-56.5-25.6-73.4-11.7-10.9-38.7-12.2-101.1 18.9-6.1 18.6-7.7 36.1-8.5 45.5-0.9 10.6-7.1 82.7 32.9 105.2 7.3 4.1 15.4 6.2 23.6 6.5-0.3 6.4-0.8 21-1.6 36.5-0.8 19.8-1.7 41-2.1 48.6 32.1-20.9 64.1-41.7 96.1-62.5 0-0.3 0-0.6 0.1-0.9 0.5-8.1 0.9-16 1.4-24.1 0.7-12.2 1.4-24.3 2.1-36.5 0.4-6.3 0.7-12.5 1.1-18.8 0-1.9-0.1-3.7-0.3-5.5v-0.5c0.1-0.6 0.2-1.2 0.3-1.7-0.1-1.8-0.2-3.4-0.3-4.9z" fill="#FFD2DC"></path>
                <path d="M729.236 280.4c0.5-33.3-26.3-60.7-59.8-61.1-33.5-0.5-61.1 26.1-61.6 59.4-0.1 9.3 1.8 18.1 5.5 25.9-16.4-3.9-33.9-4.8-50.2-1.9-9.2 1.6-32.9 6.3-49.3 25.4-4.1 4.8-12.8 15.1-14.6 30.8-0.8 7.2 0 13.2 0.9 17.2 0.1 0 0.2-0.1 0.3-0.2 62.5-31.1 89.4-29.8 101.1-18.9 18.3 17 2.9 60.6 25.6 73.5 7.9 4.5 17.2 3.4 24 1.7-2 10.3-6.5 55.8-6.8 62-0.7 12.2-1.4 24.3-2.1 36.5 8.8-6.1 19.4-15 29-27.5 23.6-30.5 26.3-62.4 27.1-73.6 3.1-43.3-14.6-75.4-21.9-87.1-0.6-1-1.4-2-2.2-3 30.4-2.6 54.5-27.9 55-59.1zM548.231 533.9c-0.5 0-0.8-0.3-0.9-0.7-0.1-0.5 0.3-1 0.7-1 5.8-1 11.8-2.3 17.5-3.8 7.8-2.1 15.7-4.8 23.1-7.8 0.5-0.2 1 0 1.2 0.5s0 1-0.5 1.2c-7.6 3.2-15.4 5.9-23.3 7.9-5.7 1.5-11.8 2.8-17.7 3.8h-0.1v-0.1z"></path>
                <path d="M672.63 423.17c-3-0.6-5.9-0.9-8.9-0.7-5.2 0.3-10.1 1.7-14.5 4.2-0.8 0.5-1.6 0.9-2.3 1.5-0.6 0.5-1.3 0.9-1.9 1.4-6.2 4.6-10.8 11.5-12.5 19.6-3.9 18.1 7.8 36 26 39.9 18.3 3.9 36.2-7.7 40.2-25.9 3.8-18.2-7.8-36.1-26.1-40z" fill="#FFD2DC"></path>
                <path d="M651.33 468.47c-0.4 0-0.6-0.2-0.8-0.5-0.2-0.5-0.1-1 0.4-1.2 3-1.5 5-4.6 5.2-8 0.2-3.4-1.6-6.8-4.6-8.6-0.3-0.2-0.5-0.5-0.5-0.8 0-0.4 0.2-0.6 0.5-0.8l30.9-17.5c0.5-0.3 1-0.1 1.3 0.4 0.3 0.5 0.1 1-0.4 1.3l-29.6 16.9c2.8 2.3 4.5 5.8 4.2 9.4-0.2 4-2.7 7.7-6.2 9.5-0.1-0.2-0.2-0.1-0.4-0.1z"></path>
                <path d="M651.231 475.2l-28.6 16.8 33.2 16.7z" fill="#00B7EA"></path>
                <path d="M855.969 661.719c-3.7 8.6-7.9 17.2-12.4 25.6-18.3 34.2-41.7 65.3-69.6 92.5s-59.8 50-94.5 67.5c-0.9 0.5-1.3 1.5-0.8 2.4-4.7 2.4-9.3 4.5-14.1 6.7-1.1 0.5-2.3 1-3.5 1.5-47 20.5-99 31.9-153.5 31.9-63.2 0-122.8-15.2-175.3-42.2 0.5-0.9 0.1-2-0.7-2.4-33.1-17.2-63.4-39.1-90.1-65.2-5.7-5.4-11.2-11.2-16.6-17.2-0.1-0.2-0.3-0.3-0.4-0.5 34.1-92.2 68.2-184.3 102.2-276.5 22.1 7.2 44.3 14.3 66.4 21.6-0.7 23.5-1.7 47.1-2.8 71.2-2 41.3-4.6 81.9-7.6 121.6 4.1-6.3 64.1-94.7 164.3-130.6-0.8 19.8-1.7 41-2.1 48.6 32.1-20.9 64-41.7 96.1-62.5 0-0.3 0-0.6 0.1-0.9 106.6 3.8 183.5 75.2 214.9 106.9z" fill="#4A90E2"></path>
                <path d="M544.669 618.819c-0.2 0-0.3 0-0.5-0.1-0.3-0.2-0.5-0.5-0.5-0.8l1.4-31.2c0-0.5 0.5-0.9 0.9-0.9 0.5 0 0.9 0.5 0.9 0.9l-1.3 29.5 86-55.8c0.5-0.3 1-0.2 1.3 0.3 0.3 0.5 0.2 1-0.3 1.3l-87.4 56.8c-0.1-0.1-0.3 0-0.5 0z" fill="#D5E0EA"></path>
                <path d="M609.768 709.857v223.5c0 4.1-3.1 7.5-7.2 8-51.6 5.5-103.3 11.2-155 16.7-1.6 0.2-3.1-0.1-4.5-0.8-37.5-18.5-74.9-37.1-112.4-55.6-3-1.5-4.8-4.6-4.5-7.9 1.3-14.2 2.6-28.5 3.8-42.7 5-55.9 10.1-111.8 15.2-167.7 0.5-6.2 7.7-9.4 12.7-5.9 0.1 0 0.1 0.1 0.2 0.1 24.9 17.4 81.2 58.2 95.5 68.6 2.1 1.5 4.8 1.9 7.3 1.2l132.7-43.3 5.4-1.7c5.4-1.8 10.8 2.1 10.8 7.5z" fill="#1F0D60"></path>
                <path d="M423.768 948.857c-0.5-0.1-0.9-0.5-0.9-1l21.9-207.4c0.1-0.5 0.5-0.8 1-0.8 0.5 0.1 0.8 0.5 0.8 1l-21.9 207.4c-0.1 0.4-0.5 0.8-0.9 0.8zM487.268 954.857c-0.5 0-0.9-0.4-0.9-0.9l-7.5-212.6c0-0.5 0.4-0.9 0.9-0.9 0.5-0.1 0.9 0.4 0.9 0.9l7.5 212.6c0 0.4-0.4 0.9-0.9 0.9z" fill="#D5E0EA"></path>
                <path d="M593.768 704.157l-136.6 44.6s-70.3-50.9-98.9-71l19.6-7.9 79.6 63.5 115.8-44.8 20.5 15.6z" fill="#D5E0EA"></path>
                <path d="M382.537 464.694c-11.7-24.5-32.5-43.3-36.7-47-9.9-8.8-19.2-14.9-26-19-2.8-2.9-7.4-4.1-11.6-2.6l-31.6 11-6.6 15.4-2.6-0.6c-0.8-0.2-1.6-0.3-2.4-0.3-4.8 0-9.1 3.3-10.2 8.1-0.1 0.4-0.1 0.6-0.2 1v0.2c0 0.3-0.1 0.5-0.1 0.7V432.894c0 0.2 0 0.4 0.1 0.5 0 0.2 0.1 0.3 0.1 0.5s0.1 0.3 0.1 0.4c0 0.2 0.1 0.4 0.1 0.5 0 0.1 0.1 0.2 0.1 0.3 0.1 0.2 0.1 0.5 0.2 0.6v0.1c1.1 2.8 3.5 5.2 6.5 6.2l-15.2 35.4c3.1 0.2 6.2-1 8.4-3.4l16-17.8-7.6 15.9c-2.5 5.2-0.2 11.4 5 13.9 5.2 2.4 11.5 0.2 14-5l6.3-13.4-2.7 8.3c-1.8 5.4 1.2 11.3 6.7 13.1 5.5 1.8 11.4-1.2 13.3-6.6l5.7-16.8c5 10.9 12.2 17.8 15.1 20.4 22.1 7.2 44.3 14.3 66.4 21.6-0.7-13.3-3.4-28-10.6-42.9z" fill="#FFD2DC"></path>
                <path d="M346.637 454.694c-0.2 0-0.5-0.1-0.6-0.3-10-9.2-21.3-16.5-33.6-21.8-14.3-6.2-29.4-9.6-45.1-10.1-0.5 0-0.9-0.5-0.9-0.9 0-0.5 0.5-0.9 0.9-0.9 15.9 0.5 31.3 3.9 45.8 10.1 12.5 5.4 24 12.9 34.2 22.2 0.4 0.4 0.4 0.9 0.1 1.3-0.3 0.3-0.5 0.4-0.8 0.4zM288.737 468.294c-0.1 0-0.3 0-0.4-0.1-0.5-0.2-0.6-0.7-0.5-1.2l6.5-13.6c0.2-0.5 0.7-0.6 1.2-0.5 0.5 0.2 0.6 0.7 0.5 1.2l-6.5 13.6c-0.1 0.5-0.4 0.6-0.8 0.6z"></path>
                <path d="M229.837 423.094l23.8-8.3-11.1 26-5.6 1.9c-5.7 1.9-11.9-0.8-13.8-6.3-2-5.3 1.1-11.3 6.7-13.3z" fill="#FFD2DC"></path>
                <path d="M687.683 838.994c-0.1 0.5-0.7 4.1-1.9 7-5.2 12.7-48.7 27.7-67.3 31.8-11.8 2.6-27.6 5.7-46.5 8-5.7 1.2-11.2-2.4-12.4-8.1-0.2-0.7-0.2-1.5-0.2-2.2 0-0.8 0.1-1.5 0.3-2.3-5.1 0.4-10-3.1-11-8.2-1.2-5.6 2.5-11.2 8.1-12.3l9.6-2-15.4 2.3c-0.5 0.1-1 0.1-1.6 0.1-5.1 0-9.6-3.7-10.4-8.9-0.9-5.7 3.1-11.1 8.8-11.9l62-9.2v-10.8h-57.1c-5.8 0-10.5-4.7-10.5-10.4s4.8-10.4 10.5-10.4h57.1v-24.4c11.2 0.5 26.5 2.8 42.1 11.7 19.8 11.3 31.5 29.1 34.7 40.8 2.7 10.3 1.1 19.4 1.1 19.4z" fill="#FFD2DC"></path>
                <path d="M556.483 853.494c-0.5 0-0.8-0.3-0.9-0.7s0.3-1 0.7-1.1l56.2-10.5c0.5-0.1 1 0.3 1.1 0.7s-0.3 1-0.7 1.1l-56.2 10.5h-0.2zM559.383 874.194c-0.5 0-0.8-0.3-0.9-0.7-0.1-0.5 0.2-1 0.6-1.1l58.3-13.9c0.5-0.1 1 0.2 1.1 0.6s-0.2 1-0.6 1.1l-58.3 13.9c0 0.1-0.1 0.1-0.2 0.1zM639.483 792.394h-30c-0.5 0-0.9-0.4-0.9-0.9s0.4-0.9 0.9-0.9h30c0.5 0 0.9 0.4 0.9 0.9s-0.3 0.9-0.9 0.9z"></path>
            </svg>`;

            useEffect(() => {
                if (m && window.L) {
                    const L = window.L;
                    if (lRef.current.group) lRef.current.group.clearLayers();
                    const group = L.featureGroup().addTo(m);
                    lRef.current.group = group;

                    const curPoints = JOURNEY_DATA.filter(d => d.y <= p);
                    if (curPoints.length === 0) return;

                    // 1. Dotted line
                    L.polyline(curPoints.map(c => [c.lat, c.lng]), { color: '#2563eb', weight: 3, dashArray: '10,10' }).addTo(group);

                    // 2. History points
                    curPoints.forEach(pt => L.circleMarker([pt.lat, pt.lng], { radius: 5, color: '#ffffff', weight: 1, fillColor: '#1e40af', fillOpacity: 1 }).addTo(group));

                    // 3. Current point
                    const cur = curPoints[curPoints.length - 1];
                    L.marker([cur.lat, cur.lng], { 
                        icon: L.divIcon({ 
                            html: markerSvg, 
                            className: 'bg-transparent', 
                            iconAnchor: [32, 32], // Center of 64x64
                            popupAnchor: [0, -32]
                        }) 
                    })
                        .addTo(group)
                        .bindTooltip(`${cur.y} - ${cur.n}`, { permanent: true, direction: 'top', offset: [0, -40], className: 'font-bold text-blue-600 bg-white/90 border-0 shadow-sm px-2 py-1 rounded' })
                        .openTooltip();
                }
            }, [m, p]);

            return (
                <div className="fixed inset-0 z-50 bg-white flex flex-col">
                    <div className="absolute top-0 z-20 w-full p-4 flex justify-between pointer-events-none">
                        <div className="bg-white/90 p-3 rounded-xl pointer-events-auto shadow-sm border border-gray-100">
                            <h2 className="font-bold">{T['footprint.title'][lang]}</h2>
                        </div>
                        <button onClick={onBack} className="bg-white px-4 py-2 rounded-full shadow pointer-events-auto border">‚úï {T['emotion.exit'][lang]}</button>
                    </div>
                    <div className="flex-1 bg-blue-50/30"><BaseMap onL={sM} /></div>
                    <div className="bg-white p-8 border-t">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between text-sm text-gray-500 mb-2 font-mono font-bold">
                                <span>701 ({T['footprint.birth'][lang]})</span>
                                <span>724 ({T['footprint.out'][lang]})</span>
                                <span>742 ({T['footprint.capital'][lang]})</span>
                                <span>755 ({T['footprint.war'][lang]})</span>
                                <span>762 ({T['footprint.death'][lang]})</span>
                            </div>
                            <input type="range" min="701" max="762" value={p} onChange={e => sP(+e.target.value)} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600" />
                            <div className="text-center mt-2 text-blue-600 font-bold">{p}</div>
                        </div>
                    </div>
                </div>
            );
        };

        const LifePage = ({ onBack, lang }) => {
            return (
                <div className="min-h-screen bg-stone-50 text-gray-800 font-serif animate-fade-in">
                    <div className="fixed top-0 left-0 w-full bg-stone-50/90 backdrop-blur-md border-b border-stone-200 z-20 px-6 py-4 flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-gray-900 tracking-widest">{T['life.title'][lang]}</h2>
                        <button onClick={onBack} className="px-4 py-2 rounded-full bg-white border border-gray-300 text-sm hover:bg-gray-100 transition-colors">‚úï {T['life.back'][lang]}</button>
                    </div>
                    <div className="max-w-4xl mx-auto pt-24 pb-20 px-6">
                        <div className="relative border-l-2 border-stone-300 ml-6 md:ml-12 space-y-16">
                            {LIFE_EVENTS.map((e, i) => (
                                <div key={i} className="relative pl-8 md:pl-16 group">
                                    <div className="absolute -left-[9px] top-0 w-5 h-5 rounded-full bg-stone-100 border-4 border-gray-400 group-hover:border-blue-600 group-hover:scale-125 transition-all duration-300"></div>
                                    <div className="absolute -left-16 md:-left-24 top-0 text-right w-12 md:w-20">
                                        <span className="text-lg md:text-xl font-bold text-gray-400 group-hover:text-blue-600 transition-colors font-sans">{e.y}</span>
                                    </div>
                                    <div className="bg-white p-6 md:p-8 rounded-xl shadow-sm border border-stone-200 hover:shadow-lg transition-shadow duration-300">
                                        <h3 className="text-2xl font-bold mb-3 text-gray-900">{lang === 'zh' ? e.t.zh : e.t.en}</h3>
                                        <p className="text-lg text-gray-600 leading-relaxed">{lang === 'zh' ? e.d.zh : e.d.en}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const ResultPage = ({ type, data, onBack, lang }) => {
            if (type === 'three_ages') {
                let parts = data.split('|||');
                if (parts.length < 3) {
                    const fallbackText = "Ôºà...Ôºâ";
                    parts = [data, fallbackText, fallbackText];
                }
                const cards = [
                    { title: lang === 'zh' ? "ÈùíÂπ¥Êúü" : "Youth", age: lang === 'zh' ? "‰∫åÂçÅÂ≤Å ¬∑ ‰ªóÂâëÂéªÂõΩ" : "Age 20 ¬∑ Wandering", text: parts[0], theme: "text-teal-800", bg: "bg-teal-50/80", border: "border-teal-800", char: "ÁãÇ", delay: "0s" },
                    { title: lang === 'zh' ? "‰∏≠Âπ¥Êúü" : "Mid-Age", age: lang === 'zh' ? "ÂõõÂçÅÂ≤Å ¬∑ ‰æõÂ•âÁø∞Êûó" : "Age 40 ¬∑ Imperial Scholar", text: parts[1], theme: "text-amber-800", bg: "bg-amber-50/80", border: "border-amber-800", char: "ÂÇ≤", delay: "0.2s" },
                    { title: lang === 'zh' ? "ËÄÅÂπ¥Êúü" : "Old Age", age: lang === 'zh' ? "ÂÖ≠ÂçÅÂ≤Å ¬∑ ‰∏¥ÁªàÁªùÁ¨î" : "Age 60 ¬∑ Final Verse", text: parts[2], theme: "text-slate-800", bg: "bg-slate-50/80", border: "border-slate-800", char: "‰ªô", delay: "0.4s" }
                ];
                return (
                    <div className="min-h-screen bg-paper-texture py-12 px-4 md:px-8 relative overflow-hidden font-serif">
                        <div className="max-w-7xl mx-auto mb-16 flex justify-between items-center relative z-10 animate-fade-up">
                            <div>
                                <div className="text-sm text-gray-500 mb-2 uppercase tracking-widest font-sans">Time Travel Q&A</div>
                                <h2 className="text-3xl md:text-4xl font-bold text-gray-900">{lang === 'zh' ? "‰∏âÊó∂ÊúüÁöÑÂõûÂ∫î" : "Response from Three Ages"}</h2>
                            </div>
                            <button onClick={onBack} className="group px-6 py-2 rounded-full bg-white border border-gray-200 shadow-sm hover:shadow-md transition-all flex items-center gap-2">
                                <span className="text-gray-500 group-hover:text-gray-900">‚úï</span>
                                <span className="font-sans text-sm text-gray-600 group-hover:text-gray-900">{T['drink.back'][lang]}</span>
                            </button>
                        </div>
                        <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 relative z-10 pb-20">
                            {cards.map((card, index) => (
                                <div key={index} className={`relative group ink-shadow rounded-xl overflow-hidden animate-fade-up`} style={{ animationDelay: card.delay }}>
                                    <div className={`absolute -right-4 -bottom-8 text-[10rem] font-calligraphy opacity-5 select-none transition-transform group-hover:scale-110 duration-700 ${card.theme}`}>{card.char}</div>
                                    <div className={`h-full flex flex-col ${card.bg} border-t-4 ${card.border} p-8 transition-colors duration-500`}>
                                        <div className="border-b border-gray-200/50 pb-6 mb-6 flex justify-between items-start"><div className="writing-vertical h-24 text-2xl font-bold font-calligraphy tracking-widest opacity-80">{card.title}</div><div className="text-right"><div className="text-xs uppercase tracking-widest opacity-50 font-sans mb-1">Age Period</div><div className="text-sm font-bold opacity-80">{card.age}</div></div></div>
                                        <div className="flex-1"><p className="text-lg leading-loose text-gray-800 text-justify relative"><span className="text-4xl float-left mr-2 mt-[-10px] font-calligraphy opacity-30">‚Äú</span>{card.text}</p></div>
                                        <div className="mt-8 pt-4 border-t border-gray-200/30 flex items-center justify-between opacity-40 text-xs"><span>Tang Dynasty</span><div className="h-px w-12 bg-current"></div></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }
            return (
                <div className="min-h-screen bg-paper-texture flex items-center justify-center p-4 font-serif">
                    <div className="bg-white p-10 rounded-2xl shadow-xl max-w-3xl w-full relative border border-gray-100 animate-fade-up">
                        <button onClick={onBack} className="absolute top-6 right-6 text-gray-400 hover:text-black">‚úï</button>
                        <div className="flex gap-4 mb-6 border-b pb-4"><div className="w-12 h-12 rounded-full bg-gray-200 overflow-hidden"><img src="https://picx.zhimg.com/80/v2-7228406e00cce3ede863a49268a98993_720w.webp?source=2c26e567" className="w-full h-full object-cover" alt="Li Bai" /></div><div><h2 className="text-xl font-bold">{T['search.btn'][lang]}</h2><p className="text-xs text-gray-500">AI Assistant</p></div></div>
                        <div className="prose max-w-none leading-loose whitespace-pre-wrap text-gray-700">{data}</div>
                    </div>
                </div>
            );
        };

        const AboutPage = ({ onBack, lang }) => {
            return (
                <div className="min-h-screen bg-stone-50 font-sans animate-fade-in flex flex-col text-gray-900">
                    <div className="fixed top-0 left-0 w-full bg-white/90 backdrop-blur-md border-b border-gray-200 z-50 px-6 py-4 flex justify-between items-center shadow-sm">
                        <h2 className="text-xl md:text-2xl font-bold tracking-wider">{T['about.title'][lang]}</h2>
                        <button onClick={onBack} className="px-5 py-2 rounded-full bg-gray-100 border border-gray-300 text-sm hover:bg-gray-200 transition-colors font-medium">
                            ‚úï {T['drink.back'][lang]}
                        </button>
                    </div>

                    <div className="flex-1 pt-24 pb-20 px-6 overflow-y-auto custom-scrollbar">
                        <div className="max-w-6xl mx-auto space-y-20">
                            
                            <section className="animate-fade-up">
                                <div className="mb-12">
                                    <h3 className="text-3xl font-bold mb-2">{T['about.team'][lang]}</h3>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-x-6 gap-y-12">
                                    {TEAM_MEMBERS.map((member, index) => (
                                        <div key={index} className="flex flex-col text-left group">
                                            <div className="w-full aspect-square mb-4 overflow-hidden rounded-md bg-gray-100">
                                                <img src={member.avatar} alt={lang === 'zh' ? member.name.zh : member.name.en} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
                                            </div>
                                            <h4 className="text-lg font-bold text-blue-600 mb-1">{lang === 'zh' ? member.name.zh : member.name.en}</h4>
                                            <p className="text-sm text-gray-800 mb-3 leading-tight">{lang === 'zh' ? member.title.zh : member.title.en}</p>
                                            
                                            <div className="text-xs text-gray-500 space-y-1 font-mono">
                                                <p className="break-all hover:text-gray-800 cursor-pointer transition-colors">{member.email}</p>
                                                <p className="break-all hover:text-blue-600 cursor-pointer transition-colors">{member.linkedin}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </section>

{/* --- 1. ÂéüÊúâÁöÑÔºöÁ†îÁ©∂ÈóÆÈ¢ò (Research Questions) --- */}
                            <section className="animate-fade-up" style={{ animationDelay: '0.1s' }}>
                                <div className="bg-white p-8 md:p-10 rounded-2xl shadow-sm border border-gray-100 w-full">
                                    <h3 className="text-2xl font-bold mb-6 text-gray-900">{T['about.research'][lang]}</h3>
                                    <p className="leading-loose text-lg text-gray-700 text-justify">
                                        {lang === 'zh' ? RESEARCH_OVERVIEW.zh : RESEARCH_OVERVIEW.en}
                                    </p>
                                </div>
                            </section>

                            {/* --- 2. Êñ∞Â¢ûÔºöÁ†îÁ©∂ÁªìÊûú (Research Findings) --- */}
                            <section className="animate-fade-up" style={{ animationDelay: '0.15s' }}>
                                <div className="bg-white p-8 md:p-10 rounded-2xl shadow-sm border border-gray-100 w-full mt-8">
                                    <h3 className="text-2xl font-bold mb-6 text-gray-900">{T['about.findings'][lang]}</h3>
                                    <p className="leading-loose text-lg text-gray-700 text-justify">
                                        {lang === 'zh' ? RESEARCH_FINDINGS.zh : RESEARCH_FINDINGS.en}
                                    </p>
                                </div>
                            </section>

{/* --- 3. Êñ∞Â¢ûÔºöÊï∞ÊçÆÊù•Ê∫ê (Data Sources) - Â∑≤Êõ¥Êñ∞Ê†∑ÂºèÂíåÂÜÖÂÆπ --- */}
                            <section className="animate-fade-up" style={{ animationDelay: '0.2s' }}>
                                {/* ‰∏ãÈù¢Ëøô‰∏ÄË°å div ÁöÑ class Â∞±ÊòØÊéßÂà∂ÁôΩÂ∫ïÂúÜËßíÊ†∑ÂºèÁöÑÔºåÂíå‰∏äÈù¢ÁöÑÁ†îÁ©∂ÁªìÊûú‰øùÊåÅ‰∏ÄËá¥ */}
                                <div className="bg-white p-8 md:p-10 rounded-2xl shadow-sm border border-gray-100 w-full mt-8">
                                    <h3 className="text-2xl font-bold mb-6 text-gray-900">{T['about.sources'][lang]}</h3>
                                    
                                    <div className="space-y-8">
                                        {/* Á¨¨ 1 Êù°Êï∞ÊçÆ */}
                                        <div className="break-words">
                                            <h4 className="font-bold text-gray-800 mb-2 text-lg">1. Âè§Á±çÊï∞Â≠óËµÑÊ∫êÔºö„ÄäÊùéÂ§™ÁôΩÈõÜÊ≥®„ÄãÔºàÂç∑‰∏âÂçÅ‰∫îÔºöÊùéÂ§™ÁôΩÂπ¥Ë∞±Ôºâ</h4>
                                            <p className="text-sm text-gray-600 font-mono leading-relaxed select-all">
                                                Wang, Q. (Qing Dynasty). Li Taibai Ji Zhu( 35: Li Taibai Nian Pu) [Annotated collection of Li Bai's works (Vol. 35: Chronological biography of Li Bai)]. Chinese Text Project.<br/>
                                                <a href="https://ctext.org/wiki.pl?if=en&chapter=886336&remap=gb" target="_blank" className="text-blue-600 hover:underline">
                                                    https://ctext.org/wiki.pl?if=en&chapter=886336&remap=gb
                                                </a>
                                            </p>
                                        </div>

                                        {/* Á¨¨ 2 Êù°Êï∞ÊçÆ */}
                                        <div className="break-words">
                                            <h4 className="font-bold text-gray-800 mb-2 text-lg">2. Êï∞Â≠óÂèØËßÜÂåñËµÑÊ∫êÔºöÂîêÂÆãÊñáÂ≠¶ÁºñÂπ¥Âú∞ÂõæÔºàÊùéÁôΩ‰∏ìÈ¢òÔºâ</h4>
                                            <p className="text-sm text-gray-600 font-mono leading-relaxed select-all">
                                                Suzhou Tupu Information Technology Co., Ltd. (2025). T√°ng S√≤ng W√©nxu√© BiƒÅnni√°n D√¨t√∫ - L«ê B√°i [Chronological literary map of Tang and Song dynasties - Li Bai] (Interactive digital map) [Data support: Wang, Z. P.]. CNKGraph.<br/>
                                                <a href="https://cnkgraph.com/Map/PoetLife?author=%e6%9d%8e%e7%99%bd" target="_blank" className="text-blue-600 hover:underline">
                                                    https://cnkgraph.com/Map/PoetLife?author=%e6%9d%8e%e7%99%bd
                                                </a>
                                            </p>
                                        </div>

                                        {/* Á¨¨ 3 Êù°Êï∞ÊçÆ */}
                                        <div className="break-words">
                                            <h4 className="font-bold text-gray-800 mb-2 text-lg">3. Â≠¶ÊúØÊñáÁåÆËµÑÊ∫ê</h4>
                                            <p className="text-sm text-gray-600 font-mono leading-relaxed select-all">
                                                Pugh, E. (2023, July 4). Digital art history as disciplinary practice. In M. K. Gold & L. F. Klein (Eds.), Debates in the digital humanities 2023 (pp. 217‚Äì237, Chapter 14). University of Minnesota Press.<br/>
                                                <a href="https://dhdebates.gc.cuny.edu/read/debates-in-the-digital-humanities-2023/section/7525de5d-a6fe-4fad-ab68-00e064ea2dca" target="_blank" className="text-blue-600 hover:underline">
                                                    https://dhdebates.gc.cuny.edu/read/debates-in-the-digital-humanities-2023/section/7525de5d-a6fe-4fad-ab68-00e064ea2dca
                                                </a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section className="animate-fade-up" style={{ animationDelay: '0.2s' }}>
                                <div className="text-center mb-10">
                                    <h3 className="text-3xl font-bold mb-2">{T['about.data'][lang]}</h3>
                                    <div className="w-16 h-1 bg-emerald-600 mx-auto rounded-full"></div>
                                </div>
                                <div className="flex justify-center">
                                    <a href="https://github.com/1849083010n-cell/libaifinal.github.io" target="_blank" rel="noopener noreferrer" className="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-white transition-all duration-200 bg-gray-900 font-pj rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 hover:bg-gray-800 hover:scale-105 shadow-xl">
                                        <svg className="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </svg>
                                        {T['about.download_btn'][lang]}
                                    </a>
                                </div>
                                <div className="text-center mt-4 text-gray-500 text-sm">
                                    v1.0.0 ‚Ä¢ JSON Format ‚Ä¢ CC BY-NC-SA 4.0
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            );
        };

        const Portrait = () => {
            return (
                <div className="relative w-full aspect-square max-w-[400px] mx-auto">
                    <div className="absolute inset-0 bg-gray-100 rounded-full transform translate-x-4 translate-y-4 -z-10"></div>
                    <div className="w-full h-full rounded-full overflow-hidden shadow-2xl border-4 border-white relative bg-gray-200 flex items-center justify-center group">
                        <img src="https://picx.zhimg.com/80/v2-7228406e00cce3ede863a49268a98993_720w.webp?source=2c26e567" className="w-full h-full object-cover hover:scale-110 transition-transform duration-1000 ease-in-out" alt="Li Bai Portrait" />
                        <div className="absolute inset-0 bg-blue-900/10 group-hover:bg-transparent transition-colors duration-500"></div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [emotionSubView, setEmotionSubView] = useState('map');
            const [searchRes, setSearchRes] = useState({ type: '', data: '' });
            const [loading, setLoading] = useState(false);
            const [emoMenuOpen, setEmoMenuOpen] = useState(false);
            const menuTimeoutRef = useRef(null);

            // Language State
            const [lang, setLang] = useState('zh');

            const handleMenuEnter = () => { if (menuTimeoutRef.current) clearTimeout(menuTimeoutRef.current); setEmoMenuOpen(true); };
            const handleMenuLeave = () => { menuTimeoutRef.current = setTimeout(() => setEmoMenuOpen(false), 200); };

            const toggleLang = () => {
                setLang(prev => prev === 'zh' ? 'en' : 'zh');
            };

            const goSearch = async (q, type) => {
                setLoading(true);
                const res = await callDeepSeekAPI(type, { query: q }, lang);
                setSearchRes({ type, data: res });
                setLoading(false);
                setView('result');
            };

            const handleEmotionClick = (type) => {
                setEmotionSubView(type);
                setView('emotion');
                setEmoMenuOpen(false);
            };

            if (view === 'emotion') return <EmotionMapPage viewType={emotionSubView} onBack={() => setView('home')} lang={lang} />;
            if (view === 'drink') return <DrinkPage onBack={() => setView('home')} lang={lang} />;
            if (view === 'life') return <LifePage onBack={() => setView('home')} lang={lang} />;
            if (view === 'footprint') return <FootprintPage onBack={() => setView('home')} lang={lang} />;
            if (view === 'result') return <ResultPage type={searchRes.type} data={searchRes.data} onBack={() => setView('home')} lang={lang} />;
            if (view === 'about') return <AboutPage onBack={() => setView('home')} lang={lang} />;

            return (
                <div className="min-h-screen bg-gray-50 text-gray-900 font-sans flex flex-col relative overflow-hidden">
                    <header className="px-8 py-8 md:px-16 md:py-10 flex flex-col md:flex-row justify-between items-center max-w-7xl mx-auto w-full z-20">
                        <div className="flex items-center gap-4 mb-4 md:mb-0">
                            <div className="text-2xl font-bold tracking-widest cursor-pointer text-gray-900" onClick={() => setView('home')}>
                                {T['app.title'][lang]}
                            </div>
                            
                            {/* Language Switcher */}
                            <button 
                                onClick={toggleLang}
                                className="text-xs font-bold border border-gray-300 rounded px-2 py-1 hover:bg-gray-200 transition-colors uppercase"
                            >
                                {T['nav.lang'][lang]}
                            </button>
                        </div>

                        <nav className="flex flex-wrap justify-center gap-4">
                            <button onClick={() => setView('life')} className="group px-5 py-2.5 rounded-full bg-white border border-gray-200 shadow-sm hover:shadow-md hover:border-blue-400 transition-all duration-300 flex items-center gap-2">
                                <span className="text-lg leading-none group-hover:scale-110 transition-transform flex items-center">üìú</span>
                                <span className="text-sm font-medium text-gray-600 group-hover:text-blue-600">{T['nav.life'][lang]}</span>
                            </button>

                            <div className="relative group" onMouseEnter={handleMenuEnter} onMouseLeave={handleMenuLeave}>
                                <button className="group px-5 py-2.5 rounded-full bg-white border border-gray-200 shadow-sm hover:shadow-md hover:border-red-400 transition-all duration-300 flex items-center gap-2">
                                    <span className="text-lg leading-none group-hover:scale-110 transition-transform flex items-center">üìä</span>
                                    <span className="text-sm font-medium text-gray-600 group-hover:text-red-600">{T['nav.emotion'][lang]}</span>
                                </button>
                                {emoMenuOpen && (
                                    <div className="absolute top-full left-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 py-1 z-50 overflow-hidden animate-fade-up">
                                        <button onClick={() => handleEmotionClick('map')} className="w-full text-left px-4 py-3 text-sm hover:bg-red-50 hover:text-red-600 font-medium">
                                            {lang === 'zh' ? 'Âú∞ÁêÜÁÉ≠ÂäõÂõæ' : 'Geo Heatmap'}
                                        </button>
                                        <button onClick={() => handleEmotionClick('stats')} className="w-full text-left px-4 py-3 text-sm hover:bg-red-50 hover:text-red-600 font-medium">
                                            {lang === 'zh' ? 'ÊÑèË±°‰∏éAIËµèÊûê' : 'Imagery & AI'}
                                        </button>
                                    </div>
                                )}
                            </div>

                            <button onClick={() => setView('footprint')} className="group px-5 py-2.5 rounded-full bg-white border border-gray-200 shadow-sm hover:shadow-md hover:border-emerald-400 transition-all duration-300 flex items-center gap-2">
                                <span className="text-lg leading-none group-hover:scale-110 transition-transform flex items-center">üåè</span>
                                <span className="text-sm font-medium text-gray-600 group-hover:text-emerald-600">{T['nav.footprint'][lang]}</span>
                            </button>
                            <button onClick={() => setView('drink')} className="group px-5 py-2.5 rounded-full bg-white border border-gray-200 shadow-sm hover:shadow-md hover:border-purple-400 transition-all duration-300 flex items-center gap-2">
                                <span className="text-lg leading-none group-hover:scale-110 transition-transform flex items-center">ü•Ç</span>
                                <span className="text-sm font-medium text-gray-600 group-hover:text-purple-600">{T['nav.drink'][lang]}</span>
                            </button>
                            <button onClick={() => setView('about')} className="group px-5 py-2.5 rounded-full bg-white border border-gray-200 shadow-sm hover:shadow-md hover:border-gray-500 transition-all duration-300 flex items-center gap-2">
                                <span className="text-lg leading-none group-hover:scale-110 transition-transform flex items-center">üë•</span>
                                <span className="text-sm font-medium text-gray-600 group-hover:text-gray-900">{T['nav.about'][lang]}</span>
                            </button>
                        </nav>
                    </header>
                    <main className="flex-1 flex flex-col items-center justify-center px-8 pb-20">
                        <div className="flex flex-col-reverse lg:flex-row items-center gap-12 lg:gap-20 max-w-6xl w-full">
                            <div className="w-full lg:w-3/5 space-y-8 z-10">
                                <Typewriter lang={lang} />
                                <div className="max-w-lg">
                                    <p className="text-xl md:text-2xl text-gray-600 leading-relaxed font-serif whitespace-pre-wrap">
                                        {T['home.desc'][lang]}
                                    </p>
                                </div>
                            </div>
                            <div className="w-full lg:w-2/5 flex justify-center lg:justify-end">
                                <Portrait />
                            </div>
                        </div>

                        <div className="mt-16 w-full flex flex-col items-center">
                            <SearchSection onSearch={goSearch} loading={loading} lang={lang} />
                        </div>
                    </main>
                    <footer className="text-center py-6 text-gray-400 text-sm font-serif">
                        {T['footer.text'][lang]}
                    </footer>
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        const root = createRoot(rootElement);
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );
    </script>
</body>
</html>
